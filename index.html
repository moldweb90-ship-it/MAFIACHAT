<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Chat Widget - Flower Mafia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Telegram Custom Scrollbar */
        .tg-scrollbar::-webkit-scrollbar { width: 4px; }
        .tg-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .tg-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(0, 0, 0, 0.15); border-radius: 4px; }
        .tg-scrollbar::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 0, 0, 0.25); }

        /* Background Pattern */
        .tg-bg {
            background-color: #E6EBEF;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%236c8ea0' fill-opacity='0.12' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        /* Message Bubbles */
        .message-in::before {
            content: ""; position: absolute; left: -6px; bottom: 6px; width: 10px; height: 10px;
            background: white; border-bottom-right-radius: 10px;
            clip-path: polygon(100% 0, 100% 100%, 0 100%);
        }
        .message-out::before {
            content: ""; position: absolute; right: -6px; bottom: 6px; width: 10px; height: 10px;
            background: #EEFFDE; border-bottom-left-radius: 10px;
            clip-path: polygon(0 0, 0% 100%, 100% 100%);
        }

        /* Animations */
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        @keyframes fadeIn {
            from { opacity: 0; } to { opacity: 1; }
        }
        .widget-animate { animation: slideInUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .pop-in { animation: popIn 0.3s ease-out forwards; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }

        /* Typing Dots */
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Hide scrollbar for chips */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth Scroll behavior */
        .scroll-smooth { scroll-behavior: smooth; }

        /* Input specific */
        .chat-input-wrapper {
             transition: all 0.2s ease-in-out;
        }
        .chat-input-wrapper:focus-within {
            background-color: white;
            box-shadow: 0 0 0 2px rgba(42, 171, 238, 0.2);
            border-color: rgba(42, 171, 238, 0.4);
        }

        /* Custom margin for send button icon */
        #send-btn svg.ml-0\.5,
        #send-btn .ml-0\.5 {
            margin-left: -0.15rem !important;
        }

        /* Widget mode - remove all shadows */
        body[data-widget-mode="true"] *,
        body[data-widget-mode="true"] #chat-window,
        body[data-widget-mode="true"] #chat-window * {
            box-shadow: none !important;
        }
        
        body[data-widget-mode="true"] {
            background: transparent !important;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            #chat-window {
                width: calc(100vw - 32px) !important;
                max-width: 400px !important;
                height: 70vh !important;
                max-height: 600px !important;
                min-height: 400px !important;
                border-radius: 20px !important;
                bottom: 80px !important;
                right: 16px !important;
                top: auto !important;
                left: auto !important;
                position: fixed !important;
            }
            
            #telegram-widget-container {
                bottom: 0 !important;
                right: 0 !important;
                width: auto !important;
                height: auto !important;
            }
            
            #widget-trigger {
                width: 56px !important;
                height: 56px !important;
                bottom: 16px !important;
                right: 16px !important;
                position: fixed !important;
            }
            
            #welcome-bubble {
                bottom: 70px !important;
                right: 16px !important;
                max-width: calc(100vw - 32px) !important;
                z-index: 999999 !important;
            }
            
            /* –í —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞ –±–∞–±–±–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
            body[data-widget-mode="true"] #welcome-bubble {
                z-index: 999999 !important;
                position: fixed !important;
                overflow: visible !important;
            }
            
            /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –æ–±—Ä–µ–∑–∞—Ç—å –±–∞–±–±–ª */
            body[data-widget-mode="true"] #telegram-widget-container {
                overflow: visible !important;
            }
        }
    </style>
</head>
<body class="font-sans">

    <!-- Audio assets -->
    <audio id="notify-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" preload="auto"></audio>
    <audio id="sent-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3" preload="auto"></audio>

    <!-- WIDGET CONTAINER -->
    <div id="telegram-widget-container" class="fixed bottom-0 right-0 md:bottom-6 md:right-6 z-[9999] flex flex-col items-end gap-3 font-sans antialiased pointer-events-none" style="background: transparent;">

        <!-- Welcome Bubble -->
        <div id="welcome-bubble" class="hidden pointer-events-auto bg-white p-3 md:p-4 rounded-xl md:rounded-2xl shadow-xl mb-1 mr-4 md:mr-0 max-w-[280px] md:max-w-[290px] relative transform transition-all duration-300 origin-bottom-right border border-gray-100 hover:scale-105 cursor-pointer hover:shadow-2xl z-[10000]" onclick="toggleChat()" style="position: fixed !important; bottom: 80px !important; right: 16px !important; z-index: 999999 !important;">
            <div class="flex gap-3 items-center">
                <div class="relative w-12 h-12 rounded-full shrink-0">
                     <img src="https://raw.githubusercontent.com/moldweb90-ship-it/MAFIACHAT/main/public/Eiva.jpg" class="w-full h-full object-cover rounded-full border border-gray-100" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3E–§–æ—Ç–æ%3C/text%3E%3C/svg%3E'">
                     <span class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full animate-ping absolute inline-flex opacity-75"></span>
                     <span class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full relative inline-flex"></span>
                </div>
                <div>
                    <p class="text-[14px] md:text-[15px] font-bold text-gray-800 leading-tight">–§–ª–æ—Ä–∏—Å—Ç –ê–Ω–Ω–∞</p>
                    <p id="bubble-text" class="text-[12px] md:text-[13px] text-gray-600 leading-snug mt-0.5">
                        –Ø –æ–Ω–ª–∞–π–Ω! üëã<br>–°–¥–µ–ª–∞–µ–º —Å–∫–∏–¥–∫—É –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑?
                    </p>
                </div>
            </div>
            <button onclick="closeWelcome(event)" class="absolute -top-2 -right-2 bg-white hover:bg-gray-100 text-gray-400 hover:text-gray-600 rounded-full w-6 h-6 flex items-center justify-center text-xs shadow-md transition border border-gray-100">‚úï</button>
        </div>

        <!-- Chat Window -->
        <div id="chat-window" class="pointer-events-auto hidden bg-white w-full h-full md:w-[380px] md:h-[620px] md:max-h-[85vh] md:rounded-2xl flex flex-col overflow-hidden widget-animate border border-gray-200/50 fixed bottom-0 right-0 md:relative md:bottom-auto md:right-auto">
            
            <!-- Header -->
            <div class="bg-[#2AABEE] text-white p-2.5 px-3 md:p-3 md:px-4 flex items-center justify-between shrink-0 shadow-sm z-20">
                <div class="flex items-center gap-2 md:gap-3 cursor-pointer hover:opacity-90 transition group" onclick="openTelegramLink()">
                    <div class="relative">
                        <div class="w-9 h-9 md:w-10 md:h-10 bg-white rounded-full flex items-center justify-center overflow-hidden border-2 border-white/20 group-hover:border-white/40 transition">
                           <img src="https://raw.githubusercontent.com/moldweb90-ship-it/MAFIACHAT/main/public/Eiva.jpg" class="w-full h-full object-cover" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3E–§–æ—Ç–æ%3C/text%3E%3C/svg%3E'">
                        </div>
                        <span class="absolute bottom-0 right-0 w-2.5 h-2.5 md:w-3 md:h-3 bg-[#00E096] border-2 border-[#2AABEE] rounded-full"></span>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-[14px] md:text-[16px] leading-tight tracking-wide">–¶–≤–µ—Ç–æ—á–Ω–∞—è –ú–∞—Ñ–∏—è</span>
                        <span id="status-text" class="text-[11px] md:text-[13px] text-blue-50 opacity-90 font-medium transition-all duration-300">–≤ —Å–µ—Ç–∏</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-1.5 md:gap-2">
                    <!-- CLEAR CHAT BUTTON -->
                    <button onclick="clearChat()" class="p-1.5 md:p-2 hover:bg-white/10 rounded-full transition text-white/80 hover:text-white" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:w-5 md:h-5">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>

                    <!-- CALL OPERATOR BUTTON (Default) -->
                    <button onclick="handleManualOperatorCall()" class="flex items-center gap-1 bg-white/20 hover:bg-white/30 px-2 py-1 md:px-3 md:py-1.5 rounded-full text-[10px] md:text-[12px] font-bold transition backdrop-blur-sm border border-white/10 group shadow-sm">
                         <span class="relative flex h-1.5 w-1.5 md:h-2 md:w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-full w-full bg-white"></span>
                         </span>
                         <span class="hidden sm:inline">–û–ø–µ—Ä–∞—Ç–æ—Ä</span>
                         <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sm:hidden"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                    </button>

                    <!-- Close -->
                    <button onclick="toggleChat()" class="p-1 md:p-1.5 hover:bg-white/10 rounded-full transition text-white/80 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:w-6 md:h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </div>

            <!-- Intro Screen (Name Input) -->
            <div id="intro-screen" class="hidden absolute inset-0 bg-[#E6EBEF] z-30 flex flex-col items-center justify-center p-4 md:p-6 text-center fade-in" style="top: 50px;">
                <div class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-lg w-full max-w-xs relative overflow-hidden">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4 text-2xl md:text-3xl">üëã</div>
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-1.5 md:mb-2">–î–∞–≤–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!</h3>
                    <p class="text-gray-500 text-xs md:text-sm mb-3 md:mb-4">–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?</p>
                    
                    <input type="text" id="username-input" class="w-full bg-gray-50 border border-gray-200 rounded-lg md:rounded-xl px-3 md:px-4 py-2.5 md:py-3 mb-2.5 md:mb-3 focus:outline-none focus:ring-2 focus:ring-[#2AABEE] text-center text-sm md:text-base" placeholder="–í–∞—à–µ –∏–º—è">
                    
                    <button onclick="saveNameAndStart()" class="w-full bg-[#2AABEE] hover:bg-[#229ED9] text-white font-bold py-2.5 md:py-3 rounded-lg md:rounded-xl transition transform active:scale-95 text-sm md:text-base">
                        –ù–∞—á–∞—Ç—å —á–∞—Ç
                    </button>
                    <button onclick="skipName()" class="mt-2 md:mt-3 text-[10px] md:text-xs text-gray-400 hover:text-gray-600 underline">–ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>

            <!-- Main Chat Interface -->
            <div id="chat-interface" class="flex-1 flex flex-col h-full overflow-hidden">
                
                <!-- Messages Area -->
                <div id="messages-area" class="flex-1 tg-bg p-2 md:p-4 overflow-y-auto tg-scrollbar flex flex-col gap-2 md:gap-3 relative pb-2">
                    <!-- Messages go here -->
                </div>

                <!-- Chips (Quick Replies) with Navigation Arrows -->
                <div class="bg-white/95 backdrop-blur border-t border-gray-100 py-2 md:py-2.5 z-20 shrink-0 relative group/chips">
                    
                    <!-- Left Arrow -->
                    <button onclick="scrollChips('left')" class="hidden md:flex absolute left-0 top-0 bottom-0 w-8 items-center justify-center bg-gradient-to-r from-white via-white to-transparent z-10 text-gray-400 hover:text-[#2AABEE] transition opacity-0 group-hover/chips:opacity-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </button>

                    <!-- Chips Container -->
                    <div id="chips-container" class="flex gap-1.5 md:gap-2 overflow-x-auto no-scrollbar whitespace-nowrap px-3 md:px-4 scroll-smooth">
                         <button onclick="sendChip('–•–æ—á—É —Å–∫–∏–¥–∫—É üéÅ')" class="shrink-0 px-2.5 py-1 md:px-3 md:py-1.5 bg-gradient-to-r from-[#FF6B9D] to-[#FF8E9B] border border-[#FF6B9D]/30 text-white text-[11px] md:text-[13px] font-bold rounded-lg md:rounded-xl hover:from-[#FF5A8A] hover:to-[#FF7D8A] transition-all shadow-md active:scale-95 select-none">
                            üéÅ –•–æ—á—É —Å–∫–∏–¥–∫—É
                        </button>
                         <button onclick="sendChip('–°–∫–∏–¥–∫–∞ –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑ üî•')" class="shrink-0 px-2.5 py-1 md:px-3 md:py-1.5 bg-white border border-[#2AABEE]/20 text-[#2AABEE] text-[11px] md:text-[13px] font-semibold rounded-lg md:rounded-xl hover:bg-[#2AABEE] hover:text-white transition-all shadow-sm active:scale-95 select-none">
                            üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑
                        </button>
                        <button onclick="sendChip('–¶–µ–Ω—ã –Ω–∞ —Ü–≤–µ—Ç—ã üí∏')" class="shrink-0 px-2.5 py-1 md:px-3 md:py-1.5 bg-white border border-[#2AABEE]/20 text-[#2AABEE] text-[11px] md:text-[13px] font-semibold rounded-lg md:rounded-xl hover:bg-[#2AABEE] hover:text-white transition-all shadow-sm active:scale-95 select-none">
                            üí∏ –¶–µ–Ω—ã
                        </button>
                         <button onclick="sendChip('–ó–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é/—Å—Ç–∏—Ö üéµ')" class="shrink-0 px-2.5 py-1 md:px-3 md:py-1.5 bg-white border border-[#2AABEE]/20 text-[#2AABEE] text-[11px] md:text-[13px] font-semibold rounded-lg md:rounded-xl hover:bg-[#2AABEE] hover:text-white transition-all shadow-sm active:scale-95 select-none">
                            üéµ –í–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è
                        </button>
                        <button onclick="sendChip('–ì–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å? üìç')" class="shrink-0 px-2.5 py-1 md:px-3 md:py-1.5 bg-white border border-[#2AABEE]/20 text-[#2AABEE] text-[11px] md:text-[13px] font-semibold rounded-lg md:rounded-xl hover:bg-[#2AABEE] hover:text-white transition-all shadow-sm active:scale-95 select-none">
                            üìç –ê–¥—Ä–µ—Å
                        </button>
                    </div>

                    <!-- Right Arrow -->
                    <button onclick="scrollChips('right')" class="hidden md:flex absolute right-0 top-0 bottom-0 w-8 items-center justify-center bg-gradient-to-l from-white via-white to-transparent z-10 text-gray-400 hover:text-[#2AABEE] transition opacity-0 group-hover/chips:opacity-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </button>
                </div>

                <!-- Input Area (Refined Compact) -->
                <div class="bg-white px-2 py-1.5 md:px-3 md:py-2 flex items-end gap-1.5 md:gap-2 z-20 pb-2 md:pb-3 border-t border-gray-50 safe-area-inset-bottom">
                    <!-- Paperclip Icon -->
                    <button onclick="openTelegramLink()" class="w-7 h-8 md:w-8 md:h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 transition shrink-0" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å (–≤ Telegram)">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="md:w-[22px] md:h-[22px]"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                    </button>

                    <div class="flex-1 bg-gray-100 rounded-[1rem] md:rounded-[1.2rem] flex items-center px-3 md:px-4 py-1.5 md:py-2 min-h-[36px] md:min-h-[40px] chat-input-wrapper border border-transparent">
                        <textarea id="chat-input" rows="1" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." class="w-full bg-transparent border-none focus:ring-0 outline-none text-gray-800 text-[14px] md:text-[15px] resize-none overflow-hidden py-0.5 md:py-1 leading-relaxed placeholder-gray-400" style="max-height: 100px;"></textarea>
                    </div>
                    
                    <button id="send-btn" onclick="handleUserSend()" class="w-9 h-9 md:w-10 md:h-10 flex items-center justify-center bg-[#2AABEE] text-white rounded-full transition transform hover:scale-105 active:scale-95 hover:bg-[#229ED9] shadow-sm shrink-0">
                       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" class="fill-current ml-0.5 mt-0.5 md:w-5 md:h-5"><path d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Button -->
        <button id="widget-trigger" onclick="toggleChat()" class="pointer-events-auto group w-14 h-14 md:w-16 md:h-16 bg-[#2AABEE] rounded-full flex items-center justify-center shadow-[0_4px_14px_rgba(42,171,238,0.4)] hover:shadow-[0_8px_24px_rgba(42,171,238,0.5)] hover:bg-[#229ED9] transition-all duration-300 transform hover:scale-105 z-50 fixed bottom-4 right-4 md:relative md:bottom-auto md:right-auto md:mr-0 md:mb-0">
            <svg id="icon-closed" class="w-6 h-6 md:w-8 md:h-8 text-white fill-current transition-transform duration-300 transform group-hover:-rotate-12 translate-x-[-1px] translate-y-[1px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"></path></svg>
            <svg id="icon-opened" class="w-6 h-6 md:w-7 md:h-7 text-white hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span id="notification-badge" class="hidden absolute -top-1 -right-1 flex h-5 w-5 md:h-6 md:w-6 z-50">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span id="badge-count" class="relative inline-flex rounded-full h-full w-full bg-red-500 text-white text-[10px] md:text-[11px] items-center justify-center font-bold border-2 border-white shadow-sm">1</span>
            </span>
        </button>

    </div>

    <script>
        /* --- CONFIGURATION --- */
        const TELEGRAM_USERNAME = 'FlowersMafia_help_bot'; 
        const WELCOME_DELAY = 10000; 
        const BUBBLE_DELAY = 10000; // 10 —Å–µ–∫—É–Ω–¥ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–∞–π—Ç–µ 

        /* --- STATE --- */
        let isOpen = false;
        let messages = []; 
        let unreadCount = 0;
        let hasOpenedOnce = false;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç –ª–∏ —á–∞—Ç –∏–∑ –≤–∏–¥–∂–µ—Ç–∞ (iframe)
        const isWidgetMode = new URLSearchParams(window.location.search).get('widget') === 'true';
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è –∏–∑ localStorage (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞)
        let userName = localStorage.getItem('chat_username') || '';
        let lastBotResponse = ""; // To prevent loops
        let contextMemory = ""; // To remember dates/details

        /* --- DOM ELEMENTS --- */
        const els = {
            window: document.getElementById('chat-window'),
            intro: document.getElementById('intro-screen'),
            chatUI: document.getElementById('chat-interface'),
            usernameInput: document.getElementById('username-input'),
            trigger: document.getElementById('widget-trigger'),
            iconClosed: document.getElementById('icon-closed'),
            iconOpened: document.getElementById('icon-opened'),
            welcome: document.getElementById('welcome-bubble'),
            bubbleText: document.getElementById('bubble-text'),
            badge: document.getElementById('notification-badge'),
            badgeCount: document.getElementById('badge-count'),
            area: document.getElementById('messages-area'),
            input: document.getElementById('chat-input'),
            status: document.getElementById('status-text'),
            chips: document.getElementById('chips-container'),
            audioIn: document.getElementById('notify-sound'),
            audioOut: document.getElementById('sent-sound')
        };

        /* --- KNOWLEDGE BASE (THE BRAIN) --- */
        const knowledgeBase = [
            {
                // –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–º–∏!
                keywords: ['–∑–¥—Ä–∞–≤—Å—Ç–≤', '–ø—Ä–∏–≤–µ—Ç', '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–π –Ω–æ—á–∏', '–¥–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏', 'hi', 'hello', 'hey', '–¥–æ–±—Ä', '–ø—Ä–∏–≤'],
                answer: () => {
                    const greeting = getGreetingText();
                    const variants = [
                        `${greeting}! üëã<br>–Ø –ê–Ω–Ω–∞, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–æ—Ä–∏—Å—Ç –∏–∑ –¶–≤–µ—Ç–æ—á–Ω–æ–π –ú–∞—Ñ–∏–∏. –†–∞–¥–∞ –ø–æ–º–æ—á—å!<br><br>–ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞?<br>‚Ä¢ üí∏ –£–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã<br>‚Ä¢ üöö –£—Ç–æ—á–Ω–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É<br>‚Ä¢ üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑ —Å–æ —Å–∫–∏–¥–∫–æ–π<br>‚Ä¢ üìç –ê–¥—Ä–µ—Å–∞ –Ω–∞—à–∏—Ö —Å–∞–ª–æ–Ω–æ–≤<br>‚Ä¢ üéµ –ó–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é/—Å—Ç–∏—Ö –∫ –±—É–∫–µ—Ç—É<br><br>–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç! üòä`,
                        `${greeting}! üëã<br>–ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–Ω–Ω–∞, —è —Ñ–ª–æ—Ä–∏—Å—Ç –∏–∑ –¶–≤–µ—Ç–æ—á–Ω–æ–π –ú–∞—Ñ–∏–∏. –ì–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º –±—É–∫–µ—Ç–∞!<br><br>–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?<br>‚Ä¢ üí∏ –¶–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã<br>‚Ä¢ üöö –î–æ—Å—Ç–∞–≤–∫–∞<br>‚Ä¢ üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑ (—Å–∫–∏–¥–∫–∞ 600‚ÇΩ)<br>‚Ä¢ üìç –ì–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è<br>‚Ä¢ üéµ –ü–µ—Å–Ω–∏ –∏ —Å—Ç–∏—Ö–∏ –∫ –±—É–∫–µ—Ç—É<br><br>–ü–∏—à–∏—Ç–µ, –æ—Ç–≤–µ—á—É –±—ã—Å—Ç—Ä–æ! üòä`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['—Ü–µ–Ω—ã', '—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç', '–ø–æ—á–µ–º', '–ø—Ä–∞–π—Å', '—Å—Ç–æ–∏—Ç', '–¥–µ—à–µ–≤–æ', '–¥–æ—Ä–æ–≥–æ', '–±—é–¥–∂–µ—Ç'],
                answer: () => {
                    const variants = [
                        `–¶–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã —É –Ω–∞—Å —Ä–∞–∑–Ω—ã–µ –∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–æ—Å—Ç–∞–≤–∞, —Ä–∞–∑–º–µ—Ä–∞ –∏ —Å–µ–∑–æ–Ω–∞! üíê<br>–ï—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç 1000‚ÇΩ –¥–æ –ø—Ä–µ–º–∏—É–º-–±—É–∫–µ—Ç–æ–≤. –¢–æ—á–Ω—É—é —Ü–µ–Ω—É –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å —É —Ñ–ª–æ—Ä–∏—Å—Ç–∞ –≤ —Å–∞–ª–æ–Ω–µ ‚Äî –æ–Ω –ø–æ–¥–±–µ—Ä–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥ –≤–∞—à –±—é–¥–∂–µ—Ç –∏ –ø–æ–≤–æ–¥.<br><br>–•–æ—Ç–∏—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º? –û–Ω –ø–æ–∫–∞–∂–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—É–∫–µ—Ç—ã –∏ –Ω–∞–∑–æ–≤–µ—Ç —Ç–æ—á–Ω—ã–µ —Ü–µ–Ω—ã! üëá<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                    </button>`,
                        `–¶–µ–Ω—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–æ—Å—Ç–∞–≤–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ –±—É–∫–µ—Ç–∞! üíê<br>–£ –Ω–∞—Å –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç 1000‚ÇΩ –¥–æ –ø—Ä–µ–º–∏—É–º-–∫–æ–º–ø–æ–∑–∏—Ü–∏–π. –ß—Ç–æ–±—ã –Ω–∞–∑–≤–∞—Ç—å —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É, –ª—É—á—à–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º ‚Äî –æ–Ω –ø–æ–∫–∞–∂–µ—Ç —Å–≤–µ–∂–∏–µ —Ü–≤–µ—Ç—ã –∏ –ø–æ–¥–±–µ—Ä–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.<br><br>–°–≤—è–∑–∞—Ç—å—Å—è —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º? üëá<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                    </button>`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['—Ñ–æ—Ç–æ', '—Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ', '—Ñ–æ—Ç–∫', '—Å–º—Å', '–æ—Ç—á–µ—Ç', '—Å–Ω–∏–º', '—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏'],
                answer: () => {
                    const variants = [
                        `–ö–æ–Ω–µ—á–Ω–æ! üì∏ –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º —Ñ–æ—Ç–æ –≥–æ—Ç–æ–≤–æ–≥–æ –±—É–∫–µ—Ç–∞ –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∞–º –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∏–ª–∏ –ø–æ —Å–º—Å. –í—ã –±—É–¥–µ—Ç–µ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—é –ø—Ä–∏–µ–¥–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –≤—ã –∑–∞–∫–∞–∑–∞–ª–∏!`,
                        `–î–∞, –∫–æ–Ω–µ—á–Ω–æ! üì∏ –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –º—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π –±—É–∫–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤–∞–º ‚Äî –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∏–ª–∏ —Å–º—Å. –¢–∞–∫ –≤—ã —Ç–æ—á–Ω–æ —É–≤–∏–¥–∏—Ç–µ, —á—Ç–æ –ø–æ–ª—É—á–∏—Ç –∞–¥—Ä–µ—Å–∞—Ç!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['—Å–∞–º–æ–≤—ã–≤–æ–∑', '–∑–∞–±–µ—Ä—É', '–ø—Ä–∏–µ–¥—É', '–∞–¥—Ä–µ—Å', '–≥–¥–µ –≤—ã', '–Ω–∞—Ö–æ–¥–∏–º—Å—è', '—Å–∞–ª–æ–Ω', '–º–∞–≥–∞–∑–∏–Ω', '–æ—Ñ–∏—Å', '—Ç–æ—á–∫–∞'],
                answer: () => {
                    const variants = [
                        `–ú—ã –≤ –¥–≤—É—Ö —Ç–æ—á–∫–∞—Ö! üìç<br>1. <b>–ë—É–ª—å–≤–∞—Ä –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ! üåô)<br>2. <b>–ü—Ä-—Ç –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> (—Å 9 –¥–æ 21).<br><br>üî• –ö—Å—Ç–∞—Ç–∏, –ø—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ <b>–°–ö–ò–î–ö–ê 600‚ÇΩ</b> –Ω–∞ –±—É–∫–µ—Ç—ã! –û—Ç–ª–æ–∂–∏—Ç—å —á—Ç–æ-—Ç–æ?`,
                        `–£ –Ω–∞—Å –¥–≤–∞ —Å–∞–ª–æ–Ω–∞: üìç<br>‚Ä¢ <b>–ë—É–ª—å–≤–∞—Ä –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> ‚Äî —Ä–∞–±–æ—Ç–∞–µ–º 24/7 üåô<br>‚Ä¢ <b>–ü—Ä-—Ç –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> ‚Äî —Å 9:00 –¥–æ 21:00<br><br>üî• –ü—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ –¥–∞–µ–º <b>—Å–∫–∏–¥–∫—É 600‚ÇΩ</b>! –•–æ—Ç–∏—Ç–µ —á—Ç–æ-—Ç–æ –æ—Ç–ª–æ–∂–∏—Ç—å?`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–¥–∑–µ—Ä–∂–∏–Ω—Å–∫', '–¥–∑–µ—Ä–∂–∏–Ω'], answer: () => {
                    const variants = [
                        `–í –î–∑–µ—Ä–∂–∏–Ω—Å–∫ –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–æ–∏—Ç 1560 —Ä—É–±. üöó –£–¥–æ–±–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ, —á—Ç–æ–±—ã –º–µ–Ω–µ–¥–∂–µ—Ä —Å—Ä–∞–∑—É —É–≤–∏–¥–µ–ª –∑–∞—è–≤–∫—É!`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –î–∑–µ—Ä–∂–∏–Ω—Å–∫ ‚Äî 1560 —Ä—É–±. üöó –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ, –º–µ–Ω–µ–¥–∂–µ—Ä —Å—Ä–∞–∑—É —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–±–æ—Ä', '–±–æ—Ä—Å–∫–∏–π'], answer: () => {
                    const variants = [
                        `–ù–∞ –ë–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–æ–∏—Ç 1000 —Ä—É–±. üöó –õ–µ–≥—á–µ –≤—Å–µ–≥–æ –æ—Ñ–æ—Ä–º–∏—Ç—å —á–µ—Ä–µ–∑ –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ —Å–∞–π—Ç–µ.`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –ë–æ—Ä ‚Äî 1000 —Ä—É–±. üöó –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ, —ç—Ç–æ –∑–∞–π–º–µ—Ç –º–∏–Ω—É—Ç—É!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–∫—Å—Ç–æ–≤–æ', '–∫—Å—Ç–æ–≤'], answer: () => {
                    const variants = [
                        `–í –ö—Å—Ç–æ–≤–æ –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–æ–∏—Ç 1600 —Ä—É–±. üöó –ì–æ—Ç–æ–≤—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ?`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ö—Å—Ç–æ–≤–æ ‚Äî 1600 —Ä—É–±. üöó –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ, –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–±–∞–ª–∞—Ö–Ω–∞', '–±–∞–ª–∞—Ö–Ω'], answer: () => {
                    const variants = [
                        `–í –ë–∞–ª–∞—Ö–Ω—É –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–æ–∏—Ç 1200 —Ä—É–±. üöó`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ë–∞–ª–∞—Ö–Ω—É ‚Äî 1200 —Ä—É–±. üöó`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
             {
                keywords: ['–ø–∞–≤–ª–æ–≤–æ', '–ø–∞–≤–ª–æ–≤'], answer: () => {
                    const variants = [
                        `–í –ü–∞–≤–ª–æ–≤–æ –¥–æ—Å—Ç–∞–≤–∫–∞ 3600 —Ä—É–±. –î–∞–ª–µ–∫–æ–≤–∞—Ç–æ, –Ω–æ —Ü–≤–µ—Ç—ã –¥–æ–µ–¥—É—Ç —Å–≤–µ–∂–∏–º–∏! üå∏`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ü–∞–≤–ª–æ–≤–æ ‚Äî 3600 —Ä—É–±. üöó –î–∞–ª–µ–∫–æ, –Ω–æ –º—ã –¥–æ—Å—Ç–∞–≤–∏–º —Ü–≤–µ—Ç—ã —Å–≤–µ–∂–∏–º–∏! üå∏`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
             {
                keywords: ['–∑–∞–≤–æ–ª–∂—å–µ', '–∑–∞–≤–æ–ª–∂'], answer: () => {
                    const variants = [
                        `–í –ó–∞–≤–æ–ª–∂—å–µ ‚Äî 3000 —Ä—É–±. üöó`,
                        `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ó–∞–≤–æ–ª–∂—å–µ ‚Äî 3000 —Ä—É–±. üöó`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–æ–±–ª–∞—Å—Ç', '–∑–∞ –≥–æ—Ä–æ–¥', '–¥–∞–ª–µ–∫–æ', '–ø—Ä–∏–≥–æ—Ä–æ–¥', '–æ–±–ª–∞—Å—Ç—å'],
                answer: () => {
                    const variants = [
                        `–ó–∞ –ø—Ä–µ–¥–µ–ª—ã –≥–æ—Ä–æ–¥–∞ —Å—á–∏—Ç–∞–µ–º 40 —Ä—É–±/–∫–º. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–æ—á–Ω—ã–π –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç, —è –ø–æ–¥—Å–∫–∞–∂—É —Ü–µ–Ω—É! üëá`,
                        `–ó–∞ –≥–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Äî 40 —Ä—É–±/–∫–º. –£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å, –∏ —è –Ω–∞–∑–æ–≤—É —Å—Ç–æ–∏–º–æ—Å—Ç—å! üëá`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–æ–ø–ª–∞—Ç', '–∫–∞—Ä—Ç', '–Ω–∞–ª–∏—á–Ω', '–ø–ª–∞—Ç–µ–∂', '—Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å—Å—è', '–æ–ø–ª–∞—Ç–∏—Ç—å', '–¥–µ–Ω—å–≥–∏'],
                answer: () => {
                    const variants = [
                        `–ü—Ä–∏–Ω–∏–º–∞–µ–º –≤—Å—ë! üí≥ –ö–∞—Ä—Ç—ã (–ú–ò–†, Visa, MC), –ø–µ—Ä–µ–≤–æ–¥—ã, –Ω–∞–ª–∏—á–Ω—ã–µ –∫—É—Ä—å–µ—Ä—É (—Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π).<br>–î–∞–∂–µ WesternUnion –∏ –ó–æ–ª–æ—Ç—É—é –ö–æ—Ä–æ–Ω—É –±–µ—Ä–µ–º. –ú–∞—Ñ–∏—è –º–æ–∂–µ—Ç –≤—Å—ë üòâ`,
                        `–û–ø–ª–∞—Ç–∞ –ª—é–±–∞—è! üí≥ –ö–∞—Ä—Ç—ã, –ø–µ—Ä–µ–≤–æ–¥—ã, –Ω–∞–ª–∏—á–Ω—ã–µ –∫—É—Ä—å–µ—Ä—É. WesternUnion –∏ –ó–æ–ª–æ—Ç—É—é –ö–æ—Ä–æ–Ω—É —Ç–æ–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ–º. –ú–∞—Ñ–∏—è –º–æ–∂–µ—Ç –≤—Å—ë üòâ`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–ø–µ—Å–Ω', '—Å—Ç–∏—Ö', '–≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏', '–º—É–∑—ã–∫', 'fmvibe', '–∞—É–¥–∏–æ', '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏'],
                answer: () => {
                    const variants = [
                        `–û, —ç—Ç–æ –Ω–∞—à–∞ —Ñ–∏—à–∫–∞! üé§ –ú–æ–∂–µ–º –∑–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é –∏–ª–∏ —Å—Ç–∏—Ö –∫ –±—É–∫–µ—Ç—É —á–µ—Ä–µ–∑ <a href="https://fmvibe.ru/" target="_blank" class="text-blue-500 underline">fmvibe.ru</a>. –≠—Ñ—Ñ–µ–∫—Ç "–í–∞—É" –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω! –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?`,
                        `–î–∞, —ç—Ç–æ –Ω–∞—à–∞ —Ñ–∏—à–∫–∞! üé§ –ó–∞–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Å–Ω–∏ –∏ —Å—Ç–∏—Ö–∏ –∫ –±—É–∫–µ—Ç—É —á–µ—Ä–µ–∑ <a href="https://fmvibe.ru/" target="_blank" class="text-blue-500 underline">fmvibe.ru</a>. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –æ—á–µ–Ω—å —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω–æ! –•–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ?`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['—Ç–µ–ª–µ—Ñ–æ–Ω', '–Ω–æ–º–µ—Ä', '—Å–≤—è–∑', '–∑–≤–æ–Ω', '–ø–æ–∑–≤–æ–Ω–∏—Ç—å', '–∫–æ–Ω—Ç–∞–∫—Ç'],
                answer: () => {
                    const variants = [
                        `–ù–∞—à –Ω–æ–º–µ—Ä: <b>8 (953) 573-69-06</b> üìû<br>–ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π, –º–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É!`,
                        `–¢–µ–ª–µ—Ñ–æ–Ω: <b>8 (953) 573-69-06</b> üìû<br>–ú–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –Ω–æ–º–µ—Ä, –∏ –º—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º –≤–∞–º!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', '–±–ª–∞–≥–æ–¥–∞—Ä', '–ø–∞—Å–∏–±', '–º–µ—Ä—Å–∏'],
                answer: () => {
                    const variants = [
                        `–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! üåπ –ï—Å–ª–∏ —á—Ç–æ ‚Äî —è —Ç—É—Ç.`,
                        `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üåπ –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å, –≤—Å–µ–≥–¥–∞ –ø–æ–º–æ–≥—É!`,
                        `–†–∞–¥–∞ –ø–æ–º–æ—á—å! üåπ –ï—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏—Ç–µ!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            },
            {
                keywords: ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '–¥–æ –≤—Å—Ç—Ä–µ—á–∏', '—É–≤–∏–¥–∏–º—Å—è', '–≤—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ', '—É–¥–∞—á–∏'],
                answer: () => {
                    const variants = [
                        `–î–æ –≤—Å—Ç—Ä–µ—á–∏! üåπ –ñ–¥–µ–º –≤–∞—Å –≤ –Ω–∞—à–∏—Ö —Å–∞–ª–æ–Ω–∞—Ö!`,
                        `–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! üåπ –ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!`,
                        `–í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ! üåπ –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å, –≤—Å–µ–≥–¥–∞ –ø–æ–º–æ–≥—É!`
                    ];
                    return variants[Math.floor(Math.random() * variants.length)];
                }
            }
        ];

        /* --- INITIALIZATION --- */
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            setGreeting();

            // –í —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞ (iframe) —É–±–∏—Ä–∞–µ–º –ø–æ–¥–ª–æ–∂–∫—É, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤–∏–¥–∏–º–æ–π
            if (isWidgetMode) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è CSS
                document.body.setAttribute('data-widget-mode', 'true');
                
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥–ª–æ–∂–∫—É body
                document.body.style.cssText = 'background: transparent !important; margin: 0 !important; padding: 0 !important; overflow: hidden !important;';
                document.body.classList.remove('bg-gray-50', 'h-screen');
                
                // –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω–∏ –∏ –ø–æ–¥–ª–æ–∂–∫–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                var container = document.getElementById('telegram-widget-container');
                if (container) {
                    container.style.cssText = 'background: transparent !important;';
                }
                
                // –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω–∏ –∏–∑ —á–∞—Ç–∞
                if (els.window) {
                    els.window.style.cssText += 'box-shadow: none !important; background: white !important;';
                    els.window.classList.remove('shadow-2xl');
                }
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –±–∞–±–±–ª –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ –≤ —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞
                if (els.welcome) {
                    els.welcome.style.cssText += 'position: fixed !important; z-index: 999999 !important; overflow: visible !important;';
                }
                
                // –í —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞ –ù–ï –æ—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å—Ä–∞–∑—É, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤–∏–¥–∏–º–æ–π
                els.window.classList.add('hidden'); // –ß–∞—Ç –∑–∞–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                // –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤–∏–¥–∏–º–æ–π - –ù–ï —Å–∫—Ä—ã–≤–∞–µ–º –µ—ë!
                els.iconClosed.classList.remove('hidden');
                els.iconOpened.classList.add('hidden');
                isOpen = false; // –ß–∞—Ç –∑–∞–∫—Ä—ã—Ç
                
                // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç –±–µ–∑ intro screen (–Ω–æ –æ–Ω —Å–∫—Ä—ã—Ç)
                els.intro.classList.add('hidden');
                els.chatUI.classList.remove('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º welcome bubble —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ —á–∞—Ç –∑–∞–∫—Ä—ã—Ç)
                setTimeout(() => {
                    if (!isOpen && els.welcome) { 
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ –±–∞–±–±–ª –∑–∞–∫—Ä—ã—Ç –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
                        if (!sessionStorage.getItem('bubble_closed')) {
                            els.welcome.classList.remove('hidden'); 
                            els.welcome.classList.add('pop-in'); 
                            playSound('in');
                            sessionStorage.setItem('bubble_shown', 'true');
                            // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ –ø–æ–∫–∞–∑–µ –±–∞–±–±–ª–∞
                            if (isWidgetMode && window.parent) {
                                window.parent.postMessage({ type: 'bubble-visibility', isVisible: true }, '*');
                            }
                        }
                    } 
                }, BUBBLE_DELAY);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º welcome bubble —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ —á–∞—Ç –∑–∞–∫—Ä—ã—Ç)
                setTimeout(() => { 
                    if (!isOpen && els.welcome) { 
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ –±–∞–±–±–ª –∑–∞–∫—Ä—ã—Ç –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
                        if (!sessionStorage.getItem('bubble_closed')) {
                            els.welcome.classList.remove('hidden'); 
                            els.welcome.classList.add('pop-in'); 
                            playSound('in'); 
                            sessionStorage.setItem('bubble_shown', 'true');
                            // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ –ø–æ–∫–∞–∑–µ –±–∞–±–±–ª–∞
                            if (isWidgetMode && window.parent) {
                                window.parent.postMessage({ type: 'bubble-visibility', isVisible: true }, '*');
                            }
                        }
                    } 
                }, BUBBLE_DELAY);
                    
                    // –ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
                    if (messages.length === 0) {
                        setTimeout(() => { 
                            if (!isOpen && !hasOpenedOnce) { 
                                toggleChat(true); 
                            } 
                        }, WELCOME_DELAY);
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
            if (messages.length > 0) {
                renderMessages();
                scrollToBottom();
            }
        });

        /* --- CORE LOGIC --- */
        function toggleChat(forceOpen = null) {
            if (forceOpen === true) isOpen = false;
            
            isOpen = !isOpen;
            hasOpenedOnce = true;
            vibrate();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É (–µ—Å–ª–∏ –º—ã –≤ iframe)
            if (isWidgetMode && window.parent !== window) {
                try {
                    window.parent.postMessage({
                        type: 'chat-toggle',
                        isOpen: isOpen
                    }, '*');
                } catch (e) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—é:', e);
                }
            }

            if (isOpen) {
                els.window.classList.remove('hidden');
                els.iconClosed.classList.add('hidden');
                els.iconOpened.classList.remove('hidden');
                els.welcome.classList.add('hidden');
                // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ —Å–∫—Ä—ã—Ç–∏–∏ –±–∞–±–±–ª–∞
                if (isWidgetMode && window.parent) {
                    window.parent.postMessage({ type: 'bubble-visibility', isVisible: false }, '*');
                }
                resetBadge();
                
                // Show Intro Screen if no name and no messages (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞)
                    if (!userName && messages.length === 0) {
                        els.intro.classList.remove('hidden');
                        els.chatUI.classList.add('hidden');
                        setTimeout(() => els.usernameInput.focus(), 300);
                    } else {
                        els.intro.classList.add('hidden');
                        els.chatUI.classList.remove('hidden');
                        setTimeout(() => els.input.focus(), 300);
                        scrollToBottom();
                }

            } else {
                els.window.classList.add('hidden');
                els.iconClosed.classList.remove('hidden');
                els.iconOpened.classList.add('hidden');
            }
        }

        /* --- NAME / INTRO LOGIC --- */
        function saveNameAndStart() {
            const name = els.usernameInput.value.trim();
            if (name) {
                userName = name;
                localStorage.setItem('chat_username', userName);
                els.intro.classList.add('hidden');
                els.chatUI.classList.remove('hidden');
                
                // Greeting message from bot
                const timeGreeting = getGreetingText();
                saveMessage(`${timeGreeting}, ${userName}! üëã<br>–Ø –ê–Ω–Ω–∞, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–æ—Ä–∏—Å—Ç. –ü–æ–¥—Å–∫–∞–∂—É –ø–æ —Ü–µ–Ω–∞–º, –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –ø–æ–º–æ–≥—É —É–¥–∏–≤–∏—Ç—å! –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞?`, 'in');
                
                setTimeout(() => els.input.focus(), 300);
            } else {
                els.usernameInput.classList.add('ring-2', 'ring-red-400');
                setTimeout(() => els.usernameInput.classList.remove('ring-2', 'ring-red-400'), 500);
            }
        }

        function skipName() {
            userName = '–ì–æ—Å—Ç—å';
            localStorage.setItem('chat_username', userName);
            els.intro.classList.add('hidden');
            els.chatUI.classList.remove('hidden');
            saveMessage(`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã<br>–Ø –ê–Ω–Ω–∞, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–æ—Ä–∏—Å—Ç. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`, 'in');
        }

        /* --- CHIPS SCROLL LOGIC --- */
        function scrollChips(direction) {
            const scrollAmount = 150;
            if (direction === 'left') {
                els.chips.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                els.chips.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }

        /* --- SUGGEST WEBSITE ORDER --- */
        function suggestWebsite() {
            vibrate();
            setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
            showTyping();
            
            setTimeout(() => {
                removeTyping();
                setStatus('–≤ —Å–µ—Ç–∏');
                
                const siteMsg = `
                    <div class="font-bold mb-1">‚ö°Ô∏è –õ–µ–≥–∫–æ! –ó–∞–∫–∞–∂–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ</div>
                    –≠—Ç–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±. –í –∫–∞—Ç–∞–ª–æ–≥–µ –µ—Å—Ç—å –≤—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—É–∫–µ—Ç—ã.<br>
                    –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É, –∏ —Ñ–ª–æ—Ä–∏—Å—Ç—ã —Å—Ä–∞–∑—É –Ω–∞—á–Ω—É—Ç —Å–æ–±–∏—Ä–∞—Ç—å –∑–∞–∫–∞–∑! üëá
                    <br>
                    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'}); toggleChat();" class="w-full bg-[#2AABEE] text-white font-bold py-2.5 rounded-xl hover:bg-[#229ED9] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                    </button>
                    <div class="mt-3 text-xs text-center text-gray-400">
                        –°–ª–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å? <a href="#" onclick="callFlorist(); return false;" class="underline hover:text-gray-600">–ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É</a>
                    </div>
                `;
                saveMessage(siteMsg, 'in');
                playSound('in');
            }, 800);
        }

        /* --- CALL SPECIALISTS LOGIC --- */
        
        // 1. FLORIST (For bouquet selection, custom orders)
        function callFlorist(reasonText) {
            vibrate();
            setStatus('–∑–æ–≤–µ—Ç —Ñ–ª–æ—Ä–∏—Å—Ç–∞...');
            showTyping();
            
            let contextMsg = "";
            if (contextMemory) {
                 contextMsg = `<div class="bg-blue-50 p-2 rounded text-xs text-gray-600 mb-2 border border-blue-100">üìù –Ø –ø–µ—Ä–µ–¥–∞–ª–∞ —Ñ–ª–æ—Ä–∏—Å—Ç—É: "${contextMemory}"</div>`;
            }
            
            setTimeout(() => {
                removeTyping();
                setStatus('–≤ —Å–µ—Ç–∏');
                
                const operatorMsg = `
                    <div class="font-bold mb-1">üå∑ –°–≤—è–∑—å —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º</div>
                    ${reasonText || "–§–ª–æ—Ä–∏—Å—Ç —Å–µ–π—á–∞—Å —É –≤–∏—Ç—Ä–∏–Ω—ã –∏ –ø–æ–º–æ–∂–µ—Ç —Å –≤—ã–±–æ—Ä–æ–º. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ Telegram?"}
                    <br>
                    ${contextMsg}
                    <button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                    </button>
                `;
                saveMessage(operatorMsg, 'in');
                playSound('in');
            }, 800);
        }

        // 2. MANAGER (For logistics, FM orders, technical)
        function callManager(reasonText) {
            vibrate();
            setStatus('–∑–æ–≤–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞...');
            showTyping();
            
            let contextMsg = "";
            if (contextMemory) {
                 contextMsg = `<div class="bg-gray-100 p-2 rounded text-xs text-gray-600 mb-2 border border-gray-200">üìù –ó–∞–ø—Ä–æ—Å: "${contextMemory}"</div>`;
            }

            setTimeout(() => {
                removeTyping();
                setStatus('–≤ —Å–µ—Ç–∏');
                
                const operatorMsg = `
                    <div class="font-bold mb-1">üëî –°–≤—è–∑—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
                    ${reasonText || "–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ –ª—É—á—à–µ –ø–∏—Å–∞—Ç—å —Å—é–¥–∞."}
                    <br>
                    ${contextMsg}
                    <button onclick="openTelegramLink()" class="w-full bg-[#2AABEE] text-white font-bold py-2.5 rounded-xl hover:bg-[#229ED9] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É
                    </button>
                `;
                saveMessage(operatorMsg, 'in');
                playSound('in');
            }, 800);
        }

        // 3. COMMERCE (B2B)
        function callCommerce(reasonText) {
             vibrate();
            setStatus('–∑–æ–≤–µ—Ç –æ—Ç–¥–µ–ª...');
            showTyping();

            setTimeout(() => {
                removeTyping();
                setStatus('–≤ —Å–µ—Ç–∏');
                
                const operatorMsg = `
                    <div class="font-bold mb-1">üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª</div>
                    ${reasonText || "–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ —ç—Ç–æ—Ç —á–∞—Ç."}
                    <br>
                    <button onclick="openTelegramLink()" class="w-full bg-gray-800 text-white font-bold py-2.5 rounded-xl hover:bg-black transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –û—Ç–¥–µ–ª –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
                    </button>
                `;
                saveMessage(operatorMsg, 'in');
                playSound('in');
            }, 800);
        }
        
        function handleManualOperatorCall() {
            // General fallback
            callManager("–ü–µ—Ä–µ–≤–æ–∂—É –≤–∞—Å –≤ Telegram –¥–ª—è —Å–≤—è–∑–∏.");
        }

        /* --- MESSAGING SYSTEM (THE BRAIN) --- */
        function sendChip(text) {
            vibrate();
            els.input.value = text;
            handleUserSend();
        }

        function handleUserSend() {
            const text = els.input.value.trim();
            if (!text) return;

            saveMessage(text, 'out');
            els.input.value = '';
            els.input.style.height = 'auto';
            playSound('out');

            // --- CAPTURE CONTEXT ---
            const timeMatch = text.match(/(\d{1,2}[:.]\d{2})|–∑–∞–≤—Ç—Ä–∞|—Å–µ–≥–æ–¥–Ω—è|–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞/i);
            if (timeMatch) {
                contextMemory = text;
            }

            const lowerText = text.toLowerCase();
            const greetings = ['–∑–¥—Ä–∞–≤—Å—Ç–≤', '–ø—Ä–∏–≤–µ—Ç', '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–π –Ω–æ—á–∏', '–¥–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏', 'hi', 'hello', 'hey', '–¥–æ–±—Ä', '–ø—Ä–∏–≤'];
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–≤–µ—Ç–∞ —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
            function getResponseWithGreeting(message) {
                const hasGreeting = greetings.some(g => lowerText.includes(g));
                return hasGreeting ? `${getGreetingText()}! ${message}` : message;
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
            function sendResponse(answer, delay = 1000) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, delay);
                }, 500);
            }

            // ============================================
            // –°–¢–†–û–ì–ê–Ø –ò–ï–†–ê–†–•–ò–Ø –ü–†–û–í–ï–†–û–ö (–æ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫ –æ–±—â–∏–º)
            // ============================================
            
            // --- 1. –ö–ù–û–ü–ö–ò (chips) - –°–ê–ú–´–ô –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ ---
            // –ü–†–û–°–¢–ê–Ø –ò –ü–û–ù–Ø–¢–ù–ê–Ø –õ–û–ì–ò–ö–ê: —Ç–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–≤–µ—Ç–æ–º
            const chipMap = {
                '—Ö–æ—á—É —Å–∫–∏–¥–∫—É üéÅ': () => {
                    const greeting = getGreetingText();
                    return `${greeting}! üéÅ<br><br><b>üî• –£ –Ω–∞—Å —Ä–∞–∑–¥–∞–µ–º —Å–∫–∏–¥–∫–∏ 5-10-15%!</b><br><br>üíé –†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞<br>üíé –ù–æ –µ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç ‚Äî –Ω—É–∂–Ω–æ –±—ã—Ç—å –≤ –Ω–∞—à–µ–π —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø–µ! üëá<br><br>‚ú® <b>–í –≥—Ä—É–ø–ø–µ "–¶–≤–µ—Ç–æ—á–Ω–∞—è –ú–∞—Ñ–∏—è | –°–∫–∏–¥–∫–∏ –∏ –ö—É–ø–æ–Ω—ã":</b><br>üéÅ –†–∞–∑–¥–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –∏ –∫—É–ø–æ–Ω—ã<br>üí∞ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤<br>üéâ –ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é —Ä–∞–∑—ã–≥—Ä—ã–≤–∞–µ–º –±—É–∫–µ—Ç!<br><br>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ú–∞—Ñ–∏–µ–π ‚Äî —Ç–∞–º –≤—Å–µ —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è! üëá<br><a href="https://t.me/+6sQdMez_ZYZmMDdi" target="_blank" class="block w-full bg-gradient-to-r from-[#FF6B9D] to-[#FF8E9B] text-white font-bold py-2.5 rounded-xl hover:from-[#FF5A8A] hover:to-[#FF7D8A] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-lg mt-2 no-underline">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–µ
                    </a><br><div class="text-center text-xs text-gray-500 mt-2">–ü–æ—Å–ª–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–±–µ—Ä–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–∫–∏–¥–∫—É! üíê</div>`;
                },
                '—Å–∫–∏–¥–∫–∞ –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑ üî•': () => `–ú—ã –≤ –¥–≤—É—Ö —Ç–æ—á–∫–∞—Ö! üìç<br>1. <b>–ë—É–ª—å–≤–∞—Ä –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ! üåô)<br>2. <b>–ü—Ä-—Ç –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> (—Å 9 –¥–æ 21).<br><br>üî• –ö—Å—Ç–∞—Ç–∏, –ø—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ <b>–°–ö–ò–î–ö–ê 600‚ÇΩ</b> –Ω–∞ –±—É–∫–µ—Ç—ã! –û—Ç–ª–æ–∂–∏—Ç—å —á—Ç–æ-—Ç–æ?`,
                '—Ü–µ–Ω—ã –Ω–∞ —Ü–≤–µ—Ç—ã üí∏': () => `–¶–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã —É –Ω–∞—Å —Ä–∞–∑–Ω—ã–µ –∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–æ—Å—Ç–∞–≤–∞, —Ä–∞–∑–º–µ—Ä–∞ –∏ —Å–µ–∑–æ–Ω–∞! üíê<br>–ï—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç 1000‚ÇΩ –¥–æ –ø—Ä–µ–º–∏—É–º-–±—É–∫–µ—Ç–æ–≤. –¢–æ—á–Ω—É—é —Ü–µ–Ω—É –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å —É —Ñ–ª–æ—Ä–∏—Å—Ç–∞ –≤ —Å–∞–ª–æ–Ω–µ ‚Äî –æ–Ω –ø–æ–¥–±–µ—Ä–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥ –≤–∞—à –±—é–¥–∂–µ—Ç –∏ –ø–æ–≤–æ–¥.<br><br>–•–æ—Ç–∏—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º? –û–Ω –ø–æ–∫–∞–∂–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—É–∫–µ—Ç—ã –∏ –Ω–∞–∑–æ–≤–µ—Ç —Ç–æ—á–Ω—ã–µ —Ü–µ–Ω—ã! üëá<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                        –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                    </button>`,
                '–∑–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é/—Å—Ç–∏—Ö üéµ': () => `–û, —ç—Ç–æ –Ω–∞—à–∞ —Ñ–∏—à–∫–∞! üé§ –ú–æ–∂–µ–º –∑–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é –∏–ª–∏ —Å—Ç–∏—Ö –∫ –±—É–∫–µ—Ç—É —á–µ—Ä–µ–∑ <a href="https://fmvibe.ru/" target="_blank" class="text-blue-500 underline">fmvibe.ru</a>. –≠—Ñ—Ñ–µ–∫—Ç "–í–∞—É" –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω! –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?`,
                '–≥–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å? üìç': () => `–ú—ã –≤ –¥–≤—É—Ö —Ç–æ—á–∫–∞—Ö! üìç<br>1. <b>–ë—É–ª—å–≤–∞—Ä –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ! üåô)<br>2. <b>–ü—Ä-—Ç –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> (—Å 9 –¥–æ 21).<br><br>üî• –ö—Å—Ç–∞—Ç–∏, –ø—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ <b>–°–ö–ò–î–ö–ê 600‚ÇΩ</b> –Ω–∞ –±—É–∫–µ—Ç—ã! –û—Ç–ª–æ–∂–∏—Ç—å —á—Ç–æ-—Ç–æ?`
            };

            // –ü–†–û–°–¢–ê–Ø –ü–†–û–í–ï–†–ö–ê: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
            const normalizedText = text.trim();
            for (let [chipText, responseFn] of Object.entries(chipMap)) {
                if (normalizedText.toLowerCase() === chipText.toLowerCase()) {
                    sendResponse(responseFn(), 800);
                    return;
                }
            }

            // --- 2. –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø (—Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è) ---
            const hasGreetingInText = greetings.some(g => lowerText.includes(g));
            if (hasGreetingInText && lowerText.length < 30 && !lowerText.match(/[?]/)) {
                const greeting = getGreetingText();
                const variants = [
                    `${greeting}! üëã<br>–Ø –ê–Ω–Ω–∞, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–æ—Ä–∏—Å—Ç –∏–∑ –¶–≤–µ—Ç–æ—á–Ω–æ–π –ú–∞—Ñ–∏–∏. –†–∞–¥–∞ –ø–æ–º–æ—á—å!<br><br>–ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞?<br>‚Ä¢ üí∏ –£–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã<br>‚Ä¢ üöö –£—Ç–æ—á–Ω–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É<br>‚Ä¢ üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑ —Å–æ —Å–∫–∏–¥–∫–æ–π<br>‚Ä¢ üìç –ê–¥—Ä–µ—Å–∞ –Ω–∞—à–∏—Ö —Å–∞–ª–æ–Ω–æ–≤<br>‚Ä¢ üéµ –ó–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é/—Å—Ç–∏—Ö –∫ –±—É–∫–µ—Ç—É<br><br>–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç! üòä`,
                    `${greeting}! üëã<br>–ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–Ω–Ω–∞, —è —Ñ–ª–æ—Ä–∏—Å—Ç –∏–∑ –¶–≤–µ—Ç–æ—á–Ω–æ–π –ú–∞—Ñ–∏–∏. –ì–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º –±—É–∫–µ—Ç–∞!<br><br>–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?<br>‚Ä¢ üí∏ –¶–µ–Ω—ã –Ω–∞ –±—É–∫–µ—Ç—ã<br>‚Ä¢ üöö –î–æ—Å—Ç–∞–≤–∫–∞<br>‚Ä¢ üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑ (—Å–∫–∏–¥–∫–∞ 600‚ÇΩ)<br>‚Ä¢ üìç –ì–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è<br>‚Ä¢ üéµ –ü–µ—Å–Ω–∏ –∏ —Å—Ç–∏—Ö–∏ –∫ –±—É–∫–µ—Ç—É<br><br>–ü–∏—à–∏—Ç–µ, –æ—Ç–≤–µ—á—É –±—ã—Å—Ç—Ä–æ! üòä`
                ];
                sendResponse(variants[Math.floor(Math.random() * variants.length)], 800);
                return;
            }

            // --- 3. –°–¢–ê–¢–£–° –ó–ê–ö–ê–ó–ê (—Å—Ç—Ä–æ–≥–æ: "–∑–∞–∫–∞–∑" + —Å—Ç–∞—Ç—É—Å–Ω—ã–µ —Å–ª–æ–≤–∞ –ò–õ–ò –Ω–æ–º–µ—Ä FM) ---
            const hasOrderWord = lowerText.includes('–∑–∞–∫–∞–∑');
            const statusWords = ['–≥–¥–µ', '—Å—Ç–∞—Ç—É—Å', '–º–æ–π', '–º–æ–µ–≥–æ', '—Ç—Ä–µ–∫', '–∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∞–≤—è—Ç', '–∫–æ–≥–¥–∞ –ø—Ä–∏–≤–µ–∑—É—Ç', '—á—Ç–æ —Å', '–Ω–æ–º–µ—Ä', '—Ö–æ—á—É —É–∑–Ω–∞—Ç—å'];
            const hasOrderNumber = /fm\d+|—Ñ–º\d+/i.test(lowerText);
            
            if ((hasOrderWord && statusWords.some(word => lowerText.includes(word))) || hasOrderNumber) {
                const variants = [
                    "–í–æ–ø—Ä–æ—Å—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–∫–∞–∑–∞ —Ä–µ—à–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ. –ü–µ—Ä–µ–∫–ª—é—á–∞—é!",
                    "–ü–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–∫–∞–∑–∞ –ª—É—á—à–µ —Å–ø—Ä–æ—Å–∏—Ç—å —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –æ–Ω –∑–Ω–∞–µ—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏. –°–æ–µ–¥–∏–Ω—è—é!"
                ];
                callManager(variants[Math.floor(Math.random() * variants.length)]);
                return;
            }

            // --- 4. –ù–ê–õ–ò–ß–ò–ï –ö–û–ù–ö–†–ï–¢–ù–´–• –¶–í–ï–¢–û–í (—Å—Ç—Ä–æ–≥–æ: –Ω–∞–ª–∏—á–∏–µ + –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∫–∞) ---
            const flowerAvailability = ['–µ—Å—Ç—å', '–≤ –Ω–∞–ª–∏—á–∏–∏', '–µ—Å—Ç—å –ª–∏', '–∏–º–µ—é—Ç—Å—è', '–µ—Å—Ç—å —É –≤–∞—Å', '–±—ã–≤–∞–µ—Ç –ª–∏'];
            const flowerNames = ['–ø—Ä–æ—Ç–µ—è', '–ø—Ä–æ—Ç–µ–π', '—Ä–æ–∑–∞', '—Ä–æ–∑—ã', '–ø–∏–æ–Ω', '–ø–∏–æ–Ω—ã', '—Ç—é–ª—å–ø–∞–Ω', '—Ç—é–ª—å–ø–∞–Ω—ã', '–≥–µ—Ä–±–µ—Ä–∞', '–≥–µ—Ä–±–µ—Ä—ã', 
                                 '—Ä–æ–º–∞—à–∫–∞', '—Ä–æ–º–∞—à–∫–∏', '—Ä–∞–Ω—É–Ω–∫—É–ª—é—Å', '—Ä–∞–Ω—É–Ω–∫—É–ª—é—Å—ã', '—Ö—Ä–∏–∑–∞–Ω—Ç–µ–º–∞', '—Ö—Ä–∏–∑–∞–Ω—Ç–µ–º—ã', '–ª–∏–ª–∏—è', '–ª–∏–ª–∏–∏',
                                 '–±–µ–ª—ã–µ', '–∫—Ä–∞—Å–Ω—ã–µ', '—Ä–æ–∑–æ–≤—ã–µ', '–∂–µ–ª—Ç—ã–µ', '–º–µ—Ç—Ä–æ–≤—ã–µ', '–¥–ª–∏–Ω–Ω—ã–µ', '—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ', '—Å–∞–¥–æ–≤—ã–µ', '120—Å–º', '120 —Å–º',
                                 '–æ—Ä—Ö–∏–¥–µ—è', '–æ—Ä—Ö–∏–¥–µ–∏', '–∞–ª—å—Å—Ç—Ä–æ–º–µ—Ä–∏—è', '–∞–ª—å—Å—Ç—Ä–æ–º–µ—Ä–∏–∏', '—ç—É—Å—Ç–æ–º–∞', '—ç—É—Å—Ç–æ–º—ã', '–∏—Ä–∏—Å', '–∏—Ä–∏—Å—ã', '–≥–≤–æ–∑–¥–∏–∫–∞', '–≥–≤–æ–∑–¥–∏–∫–∏'];
            if (flowerAvailability.some(av => lowerText.includes(av)) && 
                (flowerNames.some(fl => lowerText.includes(fl)) || lowerText.match(/\d+\s*(—Ä–æ–∑–∞|—Ä–æ–∑—ã|–ø–∏–æ–Ω|–ø–∏–æ–Ω—ã|—Ç—é–ª—å–ø–∞–Ω|—Ç—é–ª—å–ø–∞–Ω—ã|–≥–µ—Ä–±–µ—Ä–∞|–≥–µ—Ä–±–µ—Ä—ã|—Ä–æ–º–∞—à–∫–∞|—Ä–æ–º–∞—à–∫–∏)/i))) {
                const variants = [
                    `${getResponseWithGreeting('–ü–æ –Ω–∞–ª–∏—á–∏—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å —É —Ñ–ª–æ—Ä–∏—Å—Ç–∞ –≤ —Å–∞–ª–æ–Ω–µ ‚Äî –æ–Ω –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç! üåπ<br>–§–ª–æ—Ä–∏—Å—Ç –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, –∏ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. üëá')}`,
                    `${getResponseWithGreeting('–ù–∞–ª–∏—á–∏–µ —Ü–≤–µ—Ç–æ–≤ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å! üå∏<br>–§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, —á—Ç–æ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç! üëá')}`,
                    `${getResponseWithGreeting('–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ç–æ—á–Ω–æ–µ –Ω–∞–ª–∏—á–∏–µ, –ª—É—á—à–µ —Å–ø—Ä–æ—Å–∏—Ç—å —É —Ñ–ª–æ—Ä–∏—Å—Ç–∞ –≤ —Å–∞–ª–æ–Ω–µ! üíê<br>–û–Ω –≤–∏–¥–∏—Ç —Å–≤–µ–∂–∏–µ —Ü–≤–µ—Ç—ã –∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, —á—Ç–æ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å. üëá')}`
                ];
                const answer = variants[Math.floor(Math.random() * variants.length)] + 
                    `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                sendResponse(answer);
                return;
            }


            // --- 5. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–û–í–ê–†–´ (—Å—Ç—Ä–æ–≥–æ: —Ç–æ–≤–∞—Ä + "–º–æ–∂–Ω–æ/–∑–∞–∫–∞–∑–∞—Ç—å/–µ—Å—Ç—å") ---
            const additionalProducts = ['—Ä–∞—Ñ–∞—ç–ª–ª–æ', '—Ä–∞—Ñ–∞—ç–ª–æ', '–∫–æ–Ω—Ñ–µ—Ç', '—Å–ª–∞–¥–æ—Å—Ç', '—à–æ–∫–æ–ª–∞–¥', '–ø–æ–¥–∞—Ä–æ–∫', '–ø–æ–¥–∞—Ä–∫–∏'];
            if (additionalProducts.some(prod => lowerText.includes(prod)) && 
                (lowerText.includes('–º–æ–∂–Ω–æ') || lowerText.includes('–∑–∞–∫–∞–∑–∞—Ç—å') || lowerText.includes('–µ—Å—Ç—å') || lowerText.includes('–ø—Ä–æ–¥–∞–µ—Ç–µ'))) {
                const variants = [
                    `${getResponseWithGreeting('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ü–≤–µ—Ç–∞—Ö –∏ –±—É–∫–µ—Ç–∞—Ö. üíê<br>–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–µ—Ç—ã –Ω–µ –ø—Ä–æ–¥–∞–µ–º. –ù–æ –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –±—É–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—á–Ω–æ –ø–æ—Ä–∞–¥—É–µ—Ç! –•–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã? üòä')}`,
                    `${getResponseWithGreeting('–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å —Ü–≤–µ—Ç–∞–º–∏ ‚Äî —Å–ª–∞–¥–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–µ—Ç—ã –Ω–µ –ø—Ä–æ–¥–∞–µ–º. üíê<br>–ù–æ –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å —Ä–æ—Å–∫–æ—à–Ω—ã–π –±—É–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–Ω–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–º –ø–æ–¥–∞—Ä–∫–æ–º! –§–ª–æ—Ä–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç! üëá')}`,
                    `${getResponseWithGreeting('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –Ω–∞—Å –Ω–µ—Ç —Å–ª–∞–¥–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ñ–µ—Ç ‚Äî –º—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ü–≤–µ—Ç–∞—Ö. üíê<br>–ù–æ –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –±—É–∫–µ—Ç! –§–ª–æ—Ä–∏—Å—Ç –ø–æ–∫–∞–∂–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å! üëá')}`
                ];
                const answer = variants[Math.floor(Math.random() * variants.length)] + 
                    `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                sendResponse(answer);
                return;
            }

            // --- 2. AUDIO / SONGS (Direct Request) ---
            if (lowerText.includes('–ø–µ—Å–Ω') || lowerText.includes('—Å—Ç–∏—Ö') || lowerText.includes('–º—É–∑—ã–∫') || lowerText.includes('–∞—É–¥–∏–æ') || lowerText.includes('fmvibe')) {
                 setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const answer = `–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ñ—É—Ä–æ—Ä? üé§üî•<br>–ó–∞–∫–∞–∂–∏—Ç–µ <b>–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –ø–µ—Å–Ω—é</b> –∏–ª–∏ <b>–º—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</b> –≤ –Ω–∞—à–µ–º –∞—É–¥–∏–æ-–ø—Ä–æ–¥–∞–∫—à–Ω–µ!<br>–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∫–∞, –∞ –Ω–∞—Å—Ç–æ—è—â–∞—è —ç–º–æ—Ü–∏—è. –ò–¥–µ–∞–ª—å–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –±—É–∫–µ—Ç—É. üåπüé∂<br><br>–°–ª—É—à–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –∑–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç—É—Ç: <a href="https://fmvibe.ru/" target="_blank" class="text-blue-500 font-bold underline">fmvibe.ru</a>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 3. POSTCARDS (Free + Upsell) ---
            if (lowerText.includes('–æ—Ç–∫—Ä—ã—Ç–∫') || lowerText.includes('–∑–∞–ø–∏—Å–∫') || lowerText.includes('–ø–æ–¥–ø–∏—Å') || lowerText.includes('—Ç–µ–∫—Å—Ç') || lowerText.includes('–ø–æ–∂–µ–ª–∞–Ω–∏') || lowerText.includes('—Å–ª–æ–≤–∞')) {
                 setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const answer = `–ú–∏–Ω–∏-–æ—Ç–∫—Ä—ã—Ç–∫–∞ —Å –≤–∞—à–∏–º–∏ —Ç–µ–ø–ª—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚Äî <b>–±–µ—Å–ø–ª–∞—Ç–Ω–æ</b> –∫ –∫–∞–∂–¥–æ–º—É –±—É–∫–µ—Ç—É! üíå –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.<br><br>üí° <b>–ò–¥–µ—è:</b> –•–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–º? –î–æ–±–∞–≤—å—Ç–µ –∫ –±—É–∫–µ—Ç—É <b>–∞—É–¥–∏–æ-–æ—Ç–∫—Ä—ã—Ç–∫—É</b> –∏–ª–∏ –ø–µ—Å–Ω—é!<br><br><a href="https://fmvibe.ru/" target="_blank" class="text-blue-500 underline">–ü–æ—Å–ª—É—à–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ fmvibe.ru</a>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 4. HELP / CONFUSION ---
            if (lowerText.includes('—á—Ç–æ –¥–µ–ª–∞—Ç—å') || lowerText.includes('–∫–∞–∫ –±—ã—Ç—å') || lowerText.includes('–Ω–µ –ø–æ–Ω–∏–º–∞—é') || lowerText.includes('–ø–æ–º–æ–≥–∏') || lowerText.includes('–∏–Ω—Å—Ç—Ä—É–∫—Ü')) {
                 setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                         removeTyping();
                         setStatus('–≤ —Å–µ—Ç–∏');
                         // Show split choice
                         const helpMsg = `
                            –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è! ü§ù<br>
                            üîπ <b>–•–æ—Ç–∏—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å —Ü–≤–µ—Ç—ã?</b><br>
                            –≠—Ç–æ –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–∞ —Å–∞–π—Ç–µ.<br>
                            <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); toggleChat(); return false;" class="text-blue-500 font-bold underline">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
                            <br>
                            üîπ <b>–ï—Å—Ç—å —Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å?</b><br>
                            –ù–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ Telegram, –æ–Ω –ø–æ–º–æ–∂–µ—Ç.
                            <button onclick="openTelegramLink()" class="mt-2 w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 rounded-lg transition text-xs flex items-center justify-center gap-1">
                                –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É
                            </button>
                        `;
                        saveMessage(helpMsg, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }


            // --- 5. –î–û–°–¢–ê–í–ö–ê –í –î–†–£–ì–ò–ï –ì–û–†–û–î–ê (—Ç–æ–ª—å–∫–æ –ù–ù –∏ –æ–±–ª–∞—Å—Ç—å) ---
            const otherCities = ['–≤–ª–∞–¥–∏–º–∏—Ä', '–º–æ—Å–∫–≤–∞', '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥', '–∫–∞–∑–∞–Ω—å', '—Å–∞–º–∞—Ä–∞', '–æ—Ä–µ–Ω–±—É—Ä–≥', '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', 
                                 '—á–µ–ª—è–±–∏–Ω—Å–∫', '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '—Ä–æ—Å—Ç–æ–≤', '–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä', '—Å–æ—á–∏', '–≤–æ–ª–≥–æ–≥—Ä–∞–¥', '—Å–∞—Ä–∞—Ç–æ–≤'];
            if (otherCities.some(city => lowerText.includes(city)) && (lowerText.includes('–¥–æ—Å—Ç–∞–≤') || lowerText.includes('–µ—Å—Ç—å –ª–∏ —Ü–≤–µ—Ç—ã'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –¥–æ—Å—Ç–∞–≤–∫–∞ —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ –ø–æ –ù–∏–∂–Ω–µ–º—É –ù–æ–≤–≥–æ—Ä–æ–¥—É –∏ –æ–±–ª–∞—Å—Ç–∏. üöó<br>–í –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞ –º—ã –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º. –ù–æ –µ—Å–ª–∏ –≤—ã –≤ –ù–∏–∂–Ω–µ–º ‚Äî —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–∂–µ–º —Å –∑–∞–∫–∞–∑–æ–º! üòä`,
                            `${greeting}–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –≤ –ù–∏–∂–Ω–µ–º –ù–æ–≤–≥–æ—Ä–æ–¥–µ –∏ –æ–±–ª–∞—Å—Ç–∏. üöó<br>–í –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è. –ï—Å–ª–∏ –≤—ã –≤ –ù–ù ‚Äî –º–æ–∂–µ–º –ø–æ–º–æ—á—å —Å –±—É–∫–µ—Ç–æ–º! üòä`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)];
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }


            // --- 6. –í–†–ï–ú–Ø –î–û–°–¢–ê–í–ö–ò/–°–ê–ú–û–í–´–í–û–ó–ê ---
            if ((lowerText.includes('–≤—Ä–µ–º—è') || lowerText.includes('–∫–æ–≥–¥–∞') || lowerText.includes('—á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ')) && 
                (lowerText.includes('–¥–æ—Å—Ç–∞–≤') || lowerText.includes('–∑–∞–±—Ä–∞—Ç—å') || lowerText.includes('—Å–∞–º–æ–≤—ã–≤–æ–∑') || lowerText.includes('–ø—Ä–∏–µ—Ö–∞—Ç—å'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        let answer = '';
                        if (lowerText.includes('—Å–∞–º–æ–≤—ã–≤–æ–∑') || lowerText.includes('–∑–∞–±—Ä–∞—Ç—å') || lowerText.includes('–ø—Ä–∏–µ—Ö–∞—Ç—å')) {
                            answer = `${greeting}–í—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –±—É–∫–µ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –ø—Ä–æ—Å—Ç—ã–µ –±—É–∫–µ—Ç—ã ‚Äî 30-50 –º–∏–Ω—É—Ç, —Å–ª–æ–∂–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ ‚Äî –æ–∫–æ–ª–æ —á–∞—Å–∞. ‚è∞<br>–ú–æ–∂–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ —Ç–æ—á–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏—Ç–µ, –∫–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å! üòä`;
                        } else if (lowerText.includes('—Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è') || lowerText.includes('–∏–Ω—Ç–µ—Ä–≤–∞–ª')) {
                            answer = `${greeting}–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –ú–æ–∂–µ–º –¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å 14:00 –¥–æ 15:00). ‚è∞<br>–£–∫–∞–∂–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞, –∏ –º—ã –ø–æ–¥—Å—Ç—Ä–æ–∏–º—Å—è! üòä`;
                        } else {
                            answer = `${greeting}–î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 8:00 –¥–æ 21:00. ‚è∞<br>–ú–æ–∂–µ–º –¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ, –∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ! üòä`;
                        }
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 7. –í–û–ü–†–û–°–´ –ü–†–û –ó–ê–ö–ê–ó–´ (–Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞, —Å—Ç–∞—Ç—É—Å) ---
            if ((lowerText.match(/fm\d+/i) || lowerText.match(/—Ñ–º\d+/i) || lowerText.includes('–∑–∞–∫–∞–∑') || lowerText.includes('–Ω–æ–º–µ—Ä')) && 
                (lowerText.includes('—Å—Ç–∞—Ç—É—Å') || lowerText.includes('–≥–¥–µ') || lowerText.includes('—á—Ç–æ —Ç–∞–º') || lowerText.includes('–º–æ–∂–Ω–æ') || lowerText.includes('–¥–æ–±–∞–≤–∏—Ç—å'))) {
                const variants = [
                    "–í–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞–∫–∞–∑–∞–º —Ä–µ—à–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ. –û–Ω –∑–Ω–∞–µ—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –∏ –º–æ–∂–µ—Ç –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü–µ—Ä–µ–∫–ª—é—á–∞—é!",
                    "–ü–æ –∑–∞–∫–∞–∑–∞–º –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å –∏ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏. –°–æ–µ–¥–∏–Ω—è—é!"
                ];
                callManager(variants[Math.floor(Math.random() * variants.length)]);
                return;
            }

            // --- 8. –û–¢–ú–ï–ù–ê/–ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ---
            if ((lowerText.includes('–æ—Ç–º–µ–Ω–∏—Ç—å') || lowerText.includes('–∏–∑–º–µ–Ω–∏—Ç—å') || lowerText.includes('–æ—Ç–º–µ–Ω–∞')) && 
                (lowerText.includes('–∑–∞–∫–∞–∑') || lowerText.includes('–¥–æ—Å—Ç–∞–≤–∫'))) {
                const variants = [
                    "–ü–æ –æ—Ç–º–µ–Ω–µ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –±—ã—Å—Ç—Ä–æ –≤—Å–µ —É–ª–∞–¥–∏—Ç!",
                    "–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–º–æ–∂–µ—Ç —Å –æ—Ç–º–µ–Ω–æ–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞. –ü–µ—Ä–µ–∫–ª—é—á–∞—é –Ω–∞ –Ω–µ–≥–æ!"
                ];
                callManager(variants[Math.floor(Math.random() * variants.length)]);
                return;
            }

            // --- 9. –ö–û–ù–ö–†–ï–¢–ù–´–ï –¶–í–ï–¢–´/–°–û–°–¢–ê–í –ë–£–ö–ï–¢–ê (-> FLORIST) ---
            const specificFlowerRequests = ['–Ω—É–∂–µ–Ω –±—É–∫–µ—Ç', '—Ö–æ—á—É –±—É–∫–µ—Ç', '–∫—É–ø–∏—Ç—å –±—É–∫–µ—Ç', '–∑–∞–∫–∞–∑–∞—Ç—å –±—É–∫–µ—Ç', '–Ω—É–∂–µ–Ω', '—Ö–æ—á—É', '–Ω—É–∂–Ω–æ'];
            const flowerTypes = ['–∏–∑ —Ä–∞–Ω—É–Ω–∫—É–ª—é—Å–æ–≤', '—Ä–æ–º–∞—à–∫–∏', '—Ä–æ–∑—ã', '–ø–∏–æ–Ω—ã', '—Ç—é–ª—å–ø–∞–Ω—ã', '–≥–µ—Ä–±–µ—Ä—ã', '—Å–≤–µ—Ç–ª—ã—Ö —Ç–æ–Ω–∞—Ö', '–±–µ–ª—ã–µ', '–∫—Ä–∞—Å–Ω—ã–µ', '—Ä–æ–∑–æ–≤—ã–µ', 
                                '–∂–µ–ª—Ç—ã–µ', '–≤—ã—Å–æ–∫–∏–µ', '–¥–ª–∏–Ω–Ω—ã–µ', '–º–µ—Ç—Ä–æ–≤—ã–µ', '120—Å–º', '120 —Å–º', '—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ', '—Å–∞–¥–æ–≤—ã–µ'];
            if (specificFlowerRequests.some(req => lowerText.includes(req)) && 
                (flowerTypes.some(fl => lowerText.includes(fl)) || lowerText.match(/\d+\s*(—Ä–æ–∑–∞|—Ä–æ–∑—ã|–ø–∏–æ–Ω|–ø–∏–æ–Ω—ã)/i))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! üåπ –§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ –ø–æ–∫–∞–∂–µ—Ç —Å–≤–µ–∂–∏–µ —Ü–≤–µ—Ç—ã –∏ –ø–æ–º–æ–∂–µ—Ç —Å–æ–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç –ø–æ–¥ –≤–∞—à –∑–∞–ø—Ä–æ—Å. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º ‚Äî –æ–Ω –≤—Å–µ –ø–æ–¥–±–µ—Ä–µ—Ç! üëá`,
                            `${greeting}–§–ª–æ—Ä–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç! üíê –û–Ω –≤–∏–¥–∏—Ç —Å–≤–µ–∂–∏–µ —Ü–≤–µ—Ç—ã –≤ —Å–∞–ª–æ–Ω–µ –∏ –ø–æ–¥–±–µ—Ä–µ—Ç –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –ø–æ–¥ –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ù–∞–ø–∏—à–∏—Ç–µ –µ–º—É! üëá`,
                            `${greeting}–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! üå∏ –§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ –ø–æ–∫–∞–∂–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏ —Å–æ–±–µ—Ä–µ—Ç –±—É–∫–µ—Ç –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º! üëá`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)] + 
                            `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 10. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–°–õ–£–ì–ò (—à–∞—Ä–∏–∫–∏, —É–ø–∞–∫–æ–≤–∫–∞) ---
            if (lowerText.includes('—à–∞—Ä–∏–∫') || lowerText.includes('–≥–µ–ª–∏–µ–º') || lowerText.includes('–Ω–∞–¥—É—Ç—å')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –Ω–∞–¥—É–≤–∞–µ–º —à–∞—Ä–∏–∫–∏ –≥–µ–ª–∏–µ–º ‚Äî –º—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –±—É–∫–µ—Ç–∞—Ö. üíê<br>–ù–æ –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –±—É–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—á–Ω–æ –ø–æ—Ä–∞–¥—É–µ—Ç! –•–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã? üòä`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            if (lowerText.includes('—É–ø–∞–∫–æ–≤–æ—á–Ω–∞—è –±—É–º–∞–≥–∞') || lowerText.includes('–ø–∞–∫–µ—Ç') || lowerText.includes('—Å–≤–æ–∏ –±—É–∫–µ—Ç—ã') || 
                (lowerText.includes('–±–µ–∑') && lowerText.includes('—É–ø–∞–∫–æ–≤–∫'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º–∏ –±—É–∫–µ—Ç–∞–º–∏ ‚Äî –Ω–µ –ø—Ä–æ–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ —É–ø–∞–∫–æ–≤–æ—á–Ω—É—é –±—É–º–∞–≥—É –∏–ª–∏ –ø–∞–∫–µ—Ç—ã. üíê<br>–ù–æ –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –±—É–∫–µ—Ç —Å –Ω—É–∂–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–æ–π! –§–ª–æ—Ä–∏—Å—Ç –ø–æ–¥–±–µ—Ä–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. üëá<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 12. –†–ê–ë–û–¢–ê 24/7 ---
            if (lowerText.includes('24/7') || lowerText.includes('24 7') || lowerText.includes('–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ') || 
                (lowerText.includes('—Ä–∞–±–æ—Ç–∞–µ—Ç–µ') && (lowerText.includes('–∫–æ–≥–¥–∞') || lowerText.includes('–≤—Ä–µ–º—è')))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–î–∞, –º—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ! üåô<br>–°–∞–ª–æ–Ω –Ω–∞ <b>–ë—É–ª—å–≤–∞—Ä–µ –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> –æ—Ç–∫—Ä—ã—Ç 24/7 ‚Äî –º–æ–∂–µ—Ç–µ –ø—Ä–∏–µ—Ö–∞—Ç—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è! üòä<br>–í—Ç–æ—Ä–æ–π —Å–∞–ª–æ–Ω –Ω–∞ <b>–ü—Ä-—Ç–µ –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 9:00 –¥–æ 21:00.`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 13. –ü–û–î–ì–û–¢–û–í–ö–ê –ë–£–ö–ï–¢–ê –î–õ–Ø –°–ê–ú–û–í–´–í–û–ó–ê ---
            if ((lowerText.includes('–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å') || lowerText.includes('—Å–æ–±—Ä–∞—Ç—å') || lowerText.includes('—Å–¥–µ–ª–∞—Ç—å')) && 
                (lowerText.includes('–±—É–∫–µ—Ç') || lowerText.includes('–±—É–∫–µ—Ç–∏–∫')) && 
                (lowerText.includes('—Å–∞–º–æ–≤—ã–≤–æ–∑') || lowerText.includes('–∑–∞–±—Ä–∞—Ç—å'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ö–æ–Ω–µ—á–Ω–æ! –ú–æ–∂–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±—É–∫–µ—Ç –∫ —Å–∞–º–æ–≤—ã–≤–æ–∑—É. üíê<br>–í—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏: –ø—Ä–æ—Å—Ç—ã–µ –±—É–∫–µ—Ç—ã ‚Äî 30-50 –º–∏–Ω—É—Ç, —Å–ª–æ–∂–Ω—ã–µ ‚Äî –æ–∫–æ–ª–æ —á–∞—Å–∞.<br>–£–∫–∞–∂–∏—Ç–µ, –∫–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å, –∏ –º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –∫ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏! üòä`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }


            // --- 5. COMMERCIAL (Partners -> COMMERCE) ---
            if (lowerText.includes('—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤') || lowerText.includes('–∫–æ–º–º–µ—Ä—á') || lowerText.includes('–æ–ø—Ç') || lowerText.includes('—Ä–µ–∫–ª–∞–º') || lowerText.includes('–ø–æ—Å—Ç–∞–≤')) {
                const variants = [
                    "–í–æ–ø—Ä–æ—Å—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª.",
                    "–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª. –ü–µ—Ä–µ–∫–ª—é—á–∞—é!"
                ];
                callCommerce(variants[Math.floor(Math.random() * variants.length)]);
                return;
            }
            
            // --- 6. INTERNATIONAL / NO CALL ---
            if (lowerText.includes('–Ω–µ –≤ —Ä–æ—Å—Å–∏–∏') || lowerText.includes('–∑–∞–≥—Ä–∞–Ω–∏—Ü') || lowerText.includes('–±–µ–∑ –∑–≤–æ–Ω–∫–∞') || lowerText.includes('–Ω–µ –∑–≤–æ–Ω')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        saveMessage(`–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º! üôå<br>–ú—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ <b>Western Union, MoneyGram</b> –∏ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã.<br>–ó–≤–æ–Ω–∏—Ç—å –Ω–µ –±—É–¥–µ–º, –≤—Å–µ –æ–±—Å—É–¥–∏–º –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ.`, 'in');
                        callManager("–ù–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤."); 
                    }, 1200);
                }, 500);
                return;
            }

            // --- 14. –°–†–û–ß–ù–û–°–¢–¨ –ò –≠–ö–°–¢–†–ï–ù–ù–û–°–¢–¨ ---
            if ((lowerText.includes('—Å—Ä–æ—á–Ω–æ') || lowerText.includes('–æ—á–µ–Ω—å –Ω—É–∂–Ω–æ') || lowerText.includes('–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å') || 
                 lowerText.includes('—Å–µ–≥–æ–¥–Ω—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ') || lowerText.includes('—á–µ—Ä–µ–∑ —á–∞—Å') || lowerText.includes('–æ—á–µ–Ω—å —Å—Ä–æ—á–Ω–æ')) &&
                (lowerText.includes('–¥–æ—Å—Ç–∞–≤') || lowerText.includes('–±—É–∫–µ—Ç') || lowerText.includes('–Ω—É–∂–Ω–æ'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–ü–æ–Ω—è–ª, —Å—Ä–æ—á–Ω–æ! ‚ö°<br>–ú–æ–∂–µ–º –¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è ‚Äî —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ –≤—Ä–µ–º—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–∞–π—Ç–µ.<br>–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ª—É—á—à–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! üëá`,
                            `${greeting}–ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–∂–µ–º —Å—Ä–æ—á–Ω–æ! ‚ö°<br>–û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ –∏ —É–∫–∞–∂–∏—Ç–µ "—Å—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä —Å—Ä–∞–∑—É —É–≤–∏–¥–∏—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—è–≤–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ! üöÄ`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)];
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            suggestWebsite();
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 15. –ü–†–ê–ó–î–ù–ò–ö–ò –ò –ü–û–í–û–î–´ ---
            const occasions = ['–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è', '–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏', '8 –º–∞—Ä—Ç–∞', '14 —Ñ–µ–≤—Ä–∞–ª—è', '–¥–µ–Ω—å —Å–≤—è—Ç–æ–≥–æ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∞', '—Å–≤–∞–¥—å–±–∞', '—é–±–∏–ª–µ–π', 
                              '–≤—ã–ø–∏—Å–∫–∞', '–≤—ã–ø–∏—Å–∫–∞ –∏–∑ –±–æ–ª—å–Ω–∏—Ü—ã', '—Å–æ–±–æ–ª–µ–∑–Ω–æ–≤–∞–Ω–∏', '–ø–æ—Ö–æ—Ä–æ–Ω', '–ø—Ä–æ—â–µ–Ω–∏–µ', '–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏', '–ª—é–±–æ–≤—å'];
            if (occasions.some(occ => lowerText.includes(occ))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        let answer = '';
                        if (lowerText.includes('—Å–æ–±–æ–ª–µ–∑–Ω–æ–≤–∞–Ω–∏') || lowerText.includes('–ø–æ—Ö–æ—Ä–æ–Ω')) {
                            answer = `${greeting}–°–æ–±–æ–ª–µ–∑–Ω—É–µ–º... üíê<br>–î–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ —É –Ω–∞—Å –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏. –§–ª–æ—Ä–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º ‚Äî –æ–Ω –ø–æ–¥–±–µ—Ä–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –Ω—é–∞–Ω—Å–æ–≤. üëá`;
                        } else if (lowerText.includes('8 –º–∞—Ä—Ç–∞') || lowerText.includes('14 —Ñ–µ–≤—Ä–∞–ª—è')) {
                            answer = `${greeting}–û—Ç–ª–∏—á–Ω—ã–π –ø–æ–≤–æ–¥! üåπ<br>–í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ —É –Ω–∞—Å –±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä –±—É–∫–µ—Ç–æ–≤. –§–ª–æ—Ä–∏—Å—Ç –ø–æ–∫–∞–∂–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç! üëá`;
                        } else {
                            answer = `${greeting}–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –ø–æ–≤–æ–¥ –¥–ª—è —Ü–≤–µ—Ç–æ–≤! üíê<br>–§–ª–æ—Ä–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è. –û–Ω –∑–Ω–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç —É–º–µ—Å—Ç–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ! üëá`;
                        }
                        saveMessage(answer + `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 16. –ö–ê–ß–ï–°–¢–í–û –ò –°–í–ï–ñ–ï–°–¢–¨ –¶–í–ï–¢–û–í ---
            if (lowerText.includes('—Å–≤–µ–∂–∏–µ') || lowerText.includes('—Å–≤–µ–∂–µ—Å—Ç—å') || lowerText.includes('–∫–∞—á–µ—Å—Ç–≤–æ') || 
                lowerText.includes('–∫–∞–∫ –¥–æ–ª–≥–æ –ø—Ä–æ—Å—Ç–æ—è—Ç') || lowerText.includes('–ø—Ä–æ—Å—Ç–æ—è—Ç') || lowerText.includes('–∑–∞–≤—è–ª–∏') || 
                lowerText.includes('–≥–∞—Ä–∞–Ω—Ç–∏—è') || lowerText.includes('–≥–∞—Ä–∞–Ω—Ç–∏')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–µ–∂–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏! üåπ<br>–í—Å–µ –±—É–∫–µ—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ —Ü–≤–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–µ—Ö–∞–ª–∏ –≤ –¥–µ–Ω—å –∑–∞–∫–∞–∑–∞. –§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–æ–¥–±–µ—Ä–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ! üíê`,
                            `${greeting}–ö–∞—á–µ—Å—Ç–≤–æ ‚Äî –Ω–∞—à –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç! üå∏<br>–ú—ã –ø–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ —Å–æ–±–∏—Ä–∞–µ–º –±—É–∫–µ—Ç—ã —Ç–æ–ª—å–∫–æ –∏–∑ —Å–≤–µ–∂–∏—Ö. –§–ª–æ—Ä–∏—Å—Ç –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, –∏ –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à–∏–µ! üíê`,
                            `${greeting}–í—Å–µ –Ω–∞—à–∏ —Ü–≤–µ—Ç—ã —Å–≤–µ–∂–∏–µ! üå∑<br>–ë—É–∫–µ—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –¥–µ–Ω—å –∑–∞–∫–∞–∑–∞ –∏–∑ —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–∏–µ—Ö–∞–≤—à–∏—Ö —Ü–≤–µ—Ç–æ–≤. –§–ª–æ—Ä–∏—Å—Ç –ø–æ–¥–±–µ—Ä–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –∏ –∫—Ä–∞—Å–∏–≤—ã–µ! üíê`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)];
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 17. –°–ö–ò–î–ö–ò –ò –ê–ö–¶–ò–ò ---
            if (lowerText.includes('—Å–∫–∏–¥–∫') || lowerText.includes('–∞–∫—Ü–∏') || lowerText.includes('–ø—Ä–æ–º–æ–∫–æ–¥') || 
                lowerText.includes('–ø—Ä–æ–º–æ') || lowerText.includes('—Ä–∞—Å–ø—Ä–æ–¥–∞–∂') || lowerText.includes('–¥–µ—à–µ–≤–ª–µ') || 
                lowerText.includes('–¥–µ—à–µ–≤–æ') || lowerText.includes('—ç–∫–æ–Ω–æ–º–∏')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–£ –Ω–∞—Å –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞ 600‚ÇΩ –ø—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ! üî•<br>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ. –ú–æ–∂–µ—Ç, –∑–∞–∫–∞–∂–µ—Ç–µ –±—É–∫–µ—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π? üòä`,
                            `${greeting}–ü—Ä–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ –¥–∞–µ–º —Å–∫–∏–¥–∫—É 600‚ÇΩ! üî•<br>–ê–∫—Ü–∏–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –æ–Ω –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã! üòä`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)];
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 18. –†–ê–°–°–†–û–ß–ö–ê –ò –û–ü–õ–ê–¢–ê ---
            if (lowerText.includes('—Ä–∞—Å—Å—Ä–æ—á–∫') || lowerText.includes('–≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É') || lowerText.includes('—á–∞—Å—Ç—è–º–∏') || 
                lowerText.includes('–ø–æ —á–∞—Å—Ç—è–º') || lowerText.includes('–º–æ–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Ä–∞—Å—Å—Ä–æ—á–∫–∏ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã! üí≥<br>–ú—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –∫–∞—Ä—Ç—ã, –ø–µ—Ä–µ–≤–æ–¥—ã, –Ω–∞–ª–∏—á–Ω—ã–µ –∏ –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã.`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callManager("–í–æ–ø—Ä–æ—Å –ø—Ä–æ —Ä–∞—Å—Å—Ä–æ—á–∫—É –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 19. –ù–ï–°–¢–ê–ù–î–ê–†–¢–ù–ê–Ø –î–û–°–¢–ê–í–ö–ê (–±–æ–ª—å–Ω–∏—Ü–∞, –æ—Ñ–∏—Å, –∞–Ω–æ–Ω–∏–º–Ω–∞—è) ---
            if ((lowerText.includes('–±–æ–ª—å–Ω–∏—Ü') || lowerText.includes('–±–æ–ª—å–Ω–∏—á–Ω') || lowerText.includes('–≥–æ—Å–ø–∏—Ç–∞–ª') || 
                 lowerText.includes('–æ—Ñ–∏—Å') || lowerText.includes('—Ä–∞–±–æ—Ç–∞') || lowerText.includes('–∞–Ω–æ–Ω–∏–º–Ω') || 
                 lowerText.includes('–Ω–µ –∑–≤–æ–Ω–∏—Ç—å') || lowerText.includes('–Ω–µ –∑–≤–æ–Ω–∏—Ç–µ')) && 
                (lowerText.includes('–¥–æ—Å—Ç–∞–≤') || lowerText.includes('–ø—Ä–∏–≤–µ–∑—Ç–∏'))) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        let answer = '';
                        if (lowerText.includes('–∞–Ω–æ–Ω–∏–º–Ω') || lowerText.includes('–Ω–µ –∑–≤–æ–Ω–∏—Ç—å')) {
                            answer = `${greeting}–ö–æ–Ω–µ—á–Ω–æ! –ú–æ–∂–µ–º –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ –∏ –Ω–µ –∑–≤–æ–Ω–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—é. üìû<br>–£–∫–∞–∂–∏—Ç–µ —ç—Ç–æ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–∞–π—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –∏ –º–µ–Ω–µ–¥–∂–µ—Ä —É—á—Ç–µ—Ç –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è! üòä`;
                        } else {
                            answer = `${greeting}–î–∞, –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –≤ –±–æ–ª—å–Ω–∏—Ü—ã, –æ—Ñ–∏—Å—ã –∏ –¥—Ä—É–≥–∏–µ –∞–¥—Ä–µ—Å–∞! üè•<br>–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –∏ —ç—Ç–∞–∂/–æ—Ç–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–∞–π—Ç–µ. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤—Å–µ —É—á—Ç–µ—Ç! üòä`;
                        }
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 20. –ü–û–ú–û–©–¨ –í –í–´–ë–û–†–ï ---
            if (lowerText.includes('–Ω–µ –∑–Ω–∞—é —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å') || lowerText.includes('–ø–æ–º–æ–≥–∏—Ç–µ –≤—ã–±—Ä–∞—Ç—å') || 
                lowerText.includes('—á—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—Ç–µ') || lowerText.includes('–ø–æ—Å–æ–≤–µ—Ç—É–π—Ç–µ') || 
                lowerText.includes('—á—Ç–æ –ø–æ–¥–∞—Ä–∏—Ç—å') || lowerText.includes('—á—Ç–æ –ø–æ–¥–æ–π–¥–µ—Ç') || 
                lowerText.includes('–Ω–µ –º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å') || lowerText.includes('–∑–∞—Ç—Ä—É–¥–Ω—è—é—Å—å')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å! üåπ<br>–§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç! –û–Ω –∑–Ω–∞–µ—Ç –≤—Å–µ –æ —Ü–≤–µ—Ç–∞—Ö –∏ –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç –ø–æ–¥ –≤–∞—à —Å–ª—É—á–∞–π –∏ –±—é–¥–∂–µ—Ç. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º ‚Äî –æ–Ω –≤—Å–µ –ø–æ–¥—Å–∫–∞–∂–µ—Ç! üëá`,
                            `${greeting}–° —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–∂–µ–º! üíê<br>–§–ª–æ—Ä–∏—Å—Ç –≤–∏–¥–∏—Ç –≤—Å–µ –±—É–∫–µ—Ç—ã –≤ —Å–∞–ª–æ–Ω–µ –∏ –∑–Ω–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å—Å—è. –û–Ω –ø–æ–¥–±–µ—Ä–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥ –≤–∞—à –ø–æ–≤–æ–¥ –∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è! –ù–∞–ø–∏—à–∏—Ç–µ –µ–º—É! üëá`,
                            `${greeting}–§–ª–æ—Ä–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç! üå∏<br>–û–Ω –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, —á—Ç–æ –ª—É—á—à–µ –ø–æ–¥–æ–π–¥–µ—Ç. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º ‚Äî –æ–Ω –≤—Å–µ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç! üëá`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)] + 
                            `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 21. –†–ê–ó–ú–ï–†–´ –ë–£–ö–ï–¢–û–í ---
            if (lowerText.includes('—Ä–∞–∑–º–µ—Ä') || lowerText.includes('–±–æ–ª—å—à–æ–π –±—É–∫–µ—Ç') || lowerText.includes('–º–∞–ª–µ–Ω—å–∫–∏–π –±—É–∫–µ—Ç') || 
                lowerText.includes('—Å–∫–æ–ª—å–∫–æ —Ä–æ–∑') || lowerText.includes('–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ') || lowerText.includes('—Ä–∞–∑–º–µ—Ä –±—É–∫–µ—Ç–∞')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const variants = [
                            `${greeting}–†–∞–∑–º–µ—Ä –±—É–∫–µ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–≤–µ—Ç–æ–≤ –∏ –≤–∞—à–µ–≥–æ –±—é–¥–∂–µ—Ç–∞! üíê<br>–§–ª–æ—Ä–∏—Å—Ç –ø–æ–∫–∞–∂–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º! üëá`,
                            `${greeting}–£ –Ω–∞—Å –µ—Å—Ç—å –±—É–∫–µ—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ ‚Äî –æ—Ç –Ω–µ–±–æ–ª—å—à–∏—Ö –¥–æ —Ä–æ—Å–∫–æ—à–Ω—ã—Ö! üåπ<br>–§–ª–æ—Ä–∏—Å—Ç –≤ —Å–∞–ª–æ–Ω–µ –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –ø–æ–¥–±–µ—Ä–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–¥ –≤–∞—à —Å–ª—É—á–∞–π. –ù–∞–ø–∏—à–∏—Ç–µ –µ–º—É! üëá`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)] + 
                            `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 22. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ ---
            if (lowerText.includes('–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç') || lowerText.includes('–æ—à–∏–±–∫–∞') || lowerText.includes('–Ω–µ –º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å') || 
                lowerText.includes('–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è') || lowerText.includes('–Ω–µ –ø—Ä–∏—à–ª–æ') || lowerText.includes('–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç') ||
                lowerText.includes('–ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–∞–π—Ç–æ–º') || lowerText.includes('—Å–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ò–∑–≤–∏–Ω–∏—Ç–µ –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞! üòî<br>–ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∞–π—Ç–æ–º –∏–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞, –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –≤—Ä—É—á–Ω—É—é –∏ —Ä–µ—à–∏—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã! üëá`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callManager("–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–∞–π—Ç–æ–º –∏–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 23. –ò–ó–í–ò–ù–ï–ù–ò–Ø –ò –í–ï–ñ–õ–ò–í–û–°–¢–¨ ---
            if (lowerText.includes('–∏–∑–≤–∏–Ω–∏—Ç–µ') || lowerText.includes('–∏–∑–≤–∏–Ω–∏') || lowerText.includes('–ø—Ä–æ—Å—Ç–∏—Ç–µ') || 
                lowerText.includes('–ø—Ä–æ—Å—Ç–∏') || lowerText.includes('–∏–∑–≤–∏–Ω—è—é—Å—å')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const variants = [
                            `–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ! üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`,
                            `–í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ! üòä –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`,
                            `–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ! üòä –ß–µ–º –ø–æ–º–æ—á—å?`
                        ];
                        const answer = variants[Math.floor(Math.random() * variants.length)];
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 800);
                }, 500);
                return;
            }

            // --- 24. –ö–û–†–ü–û–†–ê–¢–ò–í–ù–´–ï –ó–ê–ö–ê–ó–´ ---
            if (lowerText.includes('–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω') || lowerText.includes('–¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏') || lowerText.includes('–º–Ω–æ–≥–æ –±—É–∫–µ—Ç–æ–≤') || 
                lowerText.includes('–æ–ø—Ç–æ–º') || lowerText.includes('–º–∞—Å—Å–æ–≤') || lowerText.includes('–Ω–µ—Å–∫–æ–ª—å–∫–æ –±—É–∫–µ—Ç–æ–≤')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–û—Ç–ª–∏—á–Ω–æ! –î–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª ‚Äî –æ–Ω–∏ –ø–æ–º–æ–≥—É—Ç —Å –æ–ø—Ç–æ–≤—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏! üëá`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callCommerce("–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—É–∫–µ—Ç–æ–≤.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 25. –ù–ï–°–¢–ê–ù–î–ê–†–¢–ù–´–ï –ó–ê–ü–†–û–°–´ (–±—É–∫–µ—Ç –∏–∑ –∫–æ–Ω—Ñ–µ—Ç, –∏–≥—Ä—É—à–µ–∫) ---
            if (lowerText.includes('–±—É–∫–µ—Ç –∏–∑ –∫–æ–Ω—Ñ–µ—Ç') || lowerText.includes('–±—É–∫–µ—Ç –∏–∑ –∏–≥—Ä—É—à–µ–∫') || 
                lowerText.includes('–Ω–µ–æ–±—ã—á–Ω—ã–π –±—É–∫–µ—Ç') || lowerText.includes('—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π') || 
                lowerText.includes('–¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π') || lowerText.includes('–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∏–¥–µ—è! üíê<br>–ü–æ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –±—É–∫–µ—Ç–∞–º –ª—É—á—à–µ –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Ñ–ª–æ—Ä–∏—Å—Ç–æ–º ‚Äî –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã! üëá`;
                        saveMessage(answer + `<br><button onclick="openTelegramLink()" class="w-full bg-[#FF7EB3] text-white font-bold py-2.5 rounded-xl hover:bg-[#FF65A3] transition flex items-center justify-center gap-2 transform active:scale-95 shadow-md mt-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.56 8.35l-1.99 9.38c-.15.68-.56.84-1.13.52l-3.14-2.31-1.52 1.46c-.17.17-.31.31-.63.31l.22-3.19 5.81-5.25c.25-.22-.06-.35-.39-.12l-7.18 4.52-3.09-.97c-.67-.21-.68-.67.14-.99l12.08-4.66c.56-.21 1.05.13.82 1.3z"/></svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —Ñ–ª–æ—Ä–∏—Å—Ç—É
                        </button>`, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 26. –ü–û–í–¢–û–†–ù–´–ï –ó–ê–ö–ê–ó–´ ---
            if (lowerText.includes('—Ç–∞–∫–æ–π –∂–µ –±—É–∫–µ—Ç') || lowerText.includes('–∫–∞–∫ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑') || 
                lowerText.includes('–ø–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞') || lowerText.includes('–∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –∑–∞–∫–∞–∑–µ')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ö–æ–Ω–µ—á–Ω–æ! –ú–æ–∂–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –±—É–∫–µ—Ç! üåπ<br>–õ—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –Ω–∞–π–¥–µ—Ç –≤–∞—à –ø—Ä–æ—à–ª—ã–π –∑–∞–∫–∞–∑ –∏ –ø–æ–º–æ–∂–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å —Ç–∞–∫–æ–π –∂–µ. üëá`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callManager("–ü–æ–≤—Ç–æ—Ä –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–∫–∞–∑–∞.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 27. –í–û–ó–í–†–ê–¢ –ò –û–ë–ú–ï–ù ---
            if (lowerText.includes('–≤–µ—Ä–Ω—É—Ç—å') || lowerText.includes('–æ–±–º–µ–Ω—è—Ç—å') || lowerText.includes('–Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è') || 
                lowerText.includes('–Ω–µ –ø–æ–¥–æ—à–µ–ª') || lowerText.includes('–Ω–µ —Ç–æ—Ç –±—É–∫–µ—Ç')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–ö–æ–Ω–µ—á–Ω–æ, —Ä–∞–∑–±–µ—Ä–µ–º—Å—è! üòä<br>–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–ª–∏ –æ–±–º–µ–Ω–∞ –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é! üëá`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callManager("–í–æ–ø—Ä–æ—Å –ø—Ä–æ –≤–æ–∑–≤—Ä–∞—Ç –∏–ª–∏ –æ–±–º–µ–Ω –±—É–∫–µ—Ç–∞.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 28. –û–¢–ó–´–í–´ ---
            if (lowerText.includes('–æ—Ç–∑—ã–≤') || lowerText.includes('–æ—Ü–µ–Ω–∏—Ç—å') || lowerText.includes('—Ä–µ–π—Ç–∏–Ω–≥') || 
                lowerText.includes('–∫–∞–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤! üåπ<br>–û—Ç–∑—ã–≤—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Å–∞–π—Ç–µ –∏–ª–∏ –≤ –Ω–∞—à–∏—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö. –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –≥–¥–µ –∏–º–µ–Ω–Ω–æ! üòä`;
                        saveMessage(answer, 'in');
                        playSound('in');
                        setTimeout(() => {
                            callManager("–í–æ–ø—Ä–æ—Å –ø—Ä–æ –æ—Ç–∑—ã–≤—ã.");
                        }, 1500);
                    }, 1000);
                }, 500);
                return;
            }

            // --- 29. –ü–ê–†–ö–û–í–ö–ê –ò –ö–ê–ö –ü–†–û–ï–•–ê–¢–¨ ---
            if (lowerText.includes('–∫–∞–∫ –ø—Ä–æ–µ—Ö–∞—Ç—å') || lowerText.includes('–≥–¥–µ –ø–∞—Ä–∫–æ–≤–∫–∞') || lowerText.includes('–µ—Å—Ç—å –ø–∞—Ä–∫–æ–≤–∫–∞') || 
                lowerText.includes('–≥–¥–µ –≤—Ö–æ–¥') || lowerText.includes('–∫–∞–∫ –Ω–∞–π—Ç–∏')) {
                setTimeout(() => {
                    setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        setStatus('–≤ —Å–µ—Ç–∏');
                        const hasGreeting = greetings.some(g => lowerText.includes(g));
                        const greeting = hasGreeting ? `${getGreetingText()}! ` : '';
                        const answer = `${greeting}–£ –Ω–∞—Å –¥–≤–∞ —Å–∞–ª–æ–Ω–∞: üìç<br>1. <b>–ë—É–ª—å–≤–∞—Ä –ú–µ—â–µ—Ä—Å–∫–∏–π 3–∫3</b> ‚Äî –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ<br>2. <b>–ü—Ä-—Ç –ì–µ—Ä–æ–µ–≤ –î–æ–Ω–±–∞—Å—Å–∞, 6</b> ‚Äî —Å 9:00 –¥–æ 21:00<br><br>–ü–∞—Ä–∫–æ–≤–∫–∞ –µ—Å—Ç—å —Ä—è–¥–æ–º —Å –æ–±–æ–∏–º–∏ —Å–∞–ª–æ–Ω–∞–º–∏. –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Å–∫–∞–∂–µ—Ç —Ç–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ! üòä`;
                        saveMessage(answer, 'in');
                        playSound('in');
                    }, 1000);
                }, 500);
                return;
            }

            // --- 30. –Ø–í–ù–´–ï –ó–ê–ü–†–û–°–´ –ù–ê –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ---
            const explicitSalesTriggers = ['–æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑', '–∑–∞–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ', '–∑–∞–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É', '–æ—Ñ–æ—Ä–º–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É'];
            if (explicitSalesTriggers.some(w => lowerText.includes(w))) {
                suggestWebsite();
                return;
            }

            // --- 31. –Ø–í–ù–´–ô –ó–ê–ü–†–û–° –û–ü–ï–†–ê–¢–û–†–ê/–ú–ï–ù–ï–î–ñ–ï–†–ê ---
            if ((lowerText.includes('–æ–ø–µ—Ä–∞—Ç–æ—Ä') || lowerText.includes('–º–µ–Ω–µ–¥–∂–µ—Ä') || lowerText.includes('—á–µ–ª–æ–≤–µ–∫')) && 
                (lowerText.includes('–Ω—É–∂–µ–Ω') || lowerText.includes('—Ö–æ—á—É') || lowerText.includes('—Å–æ–µ–¥–∏–Ω–∏') || lowerText.includes('–ø–µ—Ä–µ–∫–ª—é—á–∏'))) {
                const variants = [
                    "–ö–æ–Ω–µ—á–Ω–æ! –°–æ–µ–¥–∏–Ω—è—é —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è.",
                    "–ü–µ—Ä–µ–∫–ª—é—á–∞—é –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –æ–Ω –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã!"
                ];
                callManager(variants[Math.floor(Math.random() * variants.length)]);
                return;
            }

            setStatus('–ø–µ—á–∞—Ç–∞–µ—Ç...');
            showTyping();
            
            // --- 10. FALLBACK KNOWLEDGE BASE ---
            setTimeout(() => {
                removeTyping();
                setStatus('–≤ —Å–µ—Ç–∏');
                
                let foundAnswer = null;
                
                for (let entry of knowledgeBase) {
                    if (entry.keywords.some(k => lowerText.includes(k))) {
                        foundAnswer = entry.answer();
                        break;
                    }
                }

                // –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞—Ç—å
                // if (foundAnswer && foundAnswer === lastBotResponse) {
                //      callManager("–ö–∞–∂–µ—Ç—Å—è, —è —Ö–æ–∂—É –ø–æ –∫—Ä—É–≥—É. –î–∞–≤–∞–π—Ç–µ –ø–æ–∑–æ–≤–µ–º —á–µ–ª–æ–≤–µ–∫–∞!");
                //      return;
                // }

                if (!foundAnswer) {
                     // Check context if question is short
                     if(text.length < 20 && (text.includes('?'))) {
                         const variants = [
                             "–•–º, –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏. –ü–µ—Ä–µ–≤–æ–∂—É –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –æ–Ω —Ç–æ—á–Ω–æ –ø–æ–º–æ–∂–µ—Ç!",
                             "–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è. –°–æ–µ–¥–∏–Ω—è—é —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º ‚Äî –æ–Ω —Ä–∞–∑–±–µ—Ä–µ—Ç—Å—è!"
                         ];
                         callManager(variants[Math.floor(Math.random() * variants.length)]);
                     } else {
                         const variants = [
                             "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à–µ–ª –æ—Ç–≤–µ—Ç–∞ –≤ —Å–≤–æ–µ–π –±–∞–∑–µ. –ù–æ –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç! –°–æ–µ–¥–∏–Ω–∏—Ç—å?",
                             "–•–º, —è –Ω–µ —É–≤–µ—Ä–µ–Ω–∞ –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ. –î–∞–≤–∞–π—Ç–µ —Å–ø—Ä–æ—Å–∏–º —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –æ–Ω —Ç–æ—á–Ω–æ –ø–æ–º–æ–∂–µ—Ç!",
                             "–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –ª—É—á—à–µ –∑–∞–¥–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî –æ–Ω –∑–Ω–∞–µ—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å?"
                         ];
                         callManager(variants[Math.floor(Math.random() * variants.length)]);
                     }
                     return;
                }

                saveMessage(foundAnswer, 'in');
                playSound('in');
                vibrate();
                if(!isOpen) incrementBadge(); 

            }, 800 + Math.random() * 800); 
        }

        function saveMessage(text, dir, image = null) {
            if(dir === 'in') lastBotResponse = text;

            const msg = {
                text: text,
                type: dir,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                image: image
            };
            messages.push(msg);
            localStorage.setItem('chat_history', JSON.stringify(messages));
            renderOneMessage(msg);
            scrollToBottom();
        }

        function renderMessages() {
            els.area.innerHTML = '';
            els.area.innerHTML += `
                <div class="flex justify-center my-2 opacity-80">
                    <span class="bg-black/20 text-white text-[11px] px-2 py-0.5 rounded-full font-medium shadow-sm backdrop-blur-sm">–°–µ–≥–æ–¥–Ω—è</span>
                </div>
            `;
            messages.forEach(msg => renderOneMessage(msg));
        }

        function renderOneMessage(msg) {
            const isOut = msg.type === 'out';
            const msgDiv = document.createElement('div');
            // Changed leading-snug to leading-relaxed for better spacing
            msgDiv.className = `flex flex-col ${isOut ? 'items-end max-w-[85%] self-end message-out' : 'items-start max-w-[85%] self-start message-in'} relative group pop-in`;
            
            const bubbleClass = isOut ? 'bg-[#EEFFDE] text-gray-900' : 'bg-white text-gray-900';
            const checkIcon = isOut ? '<span class="text-[#2AABEE] text-xs font-bold ml-1">‚úì‚úì</span>' : '';

            let imageHtml = '';
            if (msg.image) {
                imageHtml = `
                    <div class="mb-1 rounded-lg overflow-hidden relative cursor-pointer group/img" onclick="openTelegramLink()">
                        <img src="${msg.image}" class="w-full h-auto object-cover max-h-[160px] group-hover/img:opacity-90 transition">
                    </div>
                `;
            }

            // Simple HTML support
            let content = msg.text;
            if(!content.includes('<div') && !content.includes('<button')) {
                 content = content.replace(/\n/g, '<br>');
            }

            msgDiv.innerHTML = `
                <div class="${bubbleClass} p-2 md:p-2.5 rounded-lg md:rounded-xl ${isOut ? 'rounded-br-none' : 'rounded-bl-none'} shadow-[0_1px_2px_rgba(0,0,0,0.1)] text-[14px] md:text-[15px] leading-relaxed min-w-[60px]">
                    ${isOut ? '' : '<div class="text-[#2AABEE] text-[11px] md:text-[12px] font-bold mb-0.5 md:mb-1 leading-none">–§–ª–æ—Ä–∏—Å—Ç –ê–Ω–Ω–∞</div>'}
                    ${imageHtml}
                    ${content}
                    <div class="flex justify-end items-end gap-1 mt-0.5 md:mt-1 select-none leading-none opacity-60">
                        <span class="text-[9px] md:text-[10px] ${isOut ? 'text-[#539634]' : 'text-gray-400'}">${msg.time}</span>
                        ${checkIcon}
                    </div>
                </div>
            `;
            els.area.appendChild(msgDiv);
        }

        /* --- UTILS --- */
        function getGreetingText() {
            const hour = new Date().getHours();
            if (hour < 6) return '–î–æ–±—Ä–æ–π –Ω–æ—á–∏';
            if (hour < 12) return '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
            if (hour < 18) return '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
            return '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
        }

        function setGreeting() {
            const greeting = getGreetingText();
            els.bubbleText.innerHTML = `${greeting}! üëã<br>–°–¥–µ–ª–∞–µ–º —Å–∫–∏–¥–∫—É –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑?`;
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'flex flex-col items-start max-w-[85%] self-start relative message-in pop-in';
            typingDiv.innerHTML = `
                <div class="bg-white px-2.5 md:px-3 py-2 md:py-2.5 rounded-lg md:rounded-xl rounded-bl-none shadow-sm flex gap-1 items-center h-[32px] md:h-[36px]">
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                </div>
            `;
            els.area.appendChild(typingDiv);
            scrollToBottom();
        }

        function removeTyping() {
            const el = document.getElementById('typing-indicator');
            if (el) el.remove();
        }

        function setStatus(text) {
            els.status.innerText = text;
            if(text === '–ø–µ—á–∞—Ç–∞–µ—Ç...' || text.includes('–∑–æ–≤–µ—Ç')) els.status.classList.add('animate-pulse');
            else els.status.classList.remove('animate-pulse');
        }

        function vibrate() { if (navigator.vibrate) navigator.vibrate(10); }
        function playSound(type) { try { const audio = type === 'out' ? els.audioOut : els.audioIn; audio.currentTime = 0; audio.play().catch(e => {}); } catch(e){} }
        function scrollToBottom() { els.area.scrollTop = els.area.scrollHeight; }
        function loadHistory() { const saved = localStorage.getItem('chat_history'); if (saved) messages = JSON.parse(saved); }
        function openTelegramLink() { window.open(`https://t.me/${TELEGRAM_USERNAME}`, '_blank'); }
        function closeWelcome(e) { 
            if(e) e.stopPropagation(); 
            els.welcome.classList.add('hidden'); 
            sessionStorage.setItem('bubble_closed', 'true'); 
            sessionStorage.setItem('bubble_shown', 'true'); // –ü–æ–º–µ—á–∞–µ–º —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏
            console.log('Welcome bubble –∑–∞–∫—Ä—ã—Ç');
            // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ —Å–∫—Ä—ã—Ç–∏–∏ –±–∞–±–±–ª–∞
            if (isWidgetMode && window.parent) {
                window.parent.postMessage({ type: 'bubble-visibility', isVisible: false }, '*');
            }
        }
        function incrementBadge() { unreadCount++; els.badgeCount.innerText = unreadCount; els.badge.classList.remove('hidden'); }
        function resetBadge() { unreadCount = 0; els.badge.classList.add('hidden'); }

        /* --- CLEAR CHAT FUNCTION --- */
        function clearChat() {
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }

            // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            messages = [];
            contextMemory = "";
            lastBotResponse = "";
            unreadCount = 0;
            
            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.removeItem('chat_history');
            
            // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π
            els.area.innerHTML = '';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º badge
            resetBadge();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            setStatus('–≤ —Å–µ—Ç–∏');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ intro screen
            if (!userName || userName === '–ì–æ—Å—Ç—å') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º intro screen
                els.intro.classList.remove('hidden');
                els.chatUI.classList.add('hidden');
                els.usernameInput.value = '';
                setTimeout(() => els.usernameInput.focus(), 300);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                els.intro.classList.add('hidden');
                els.chatUI.classList.remove('hidden');
                const greeting = getGreetingText();
                saveMessage(`${greeting}, ${userName}! üëã<br>–Ø –ê–Ω–Ω–∞, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–æ—Ä–∏—Å—Ç. –ü–æ–¥—Å–∫–∞–∂—É –ø–æ —Ü–µ–Ω–∞–º, –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –ø–æ–º–æ–≥—É —É–¥–∏–≤–∏—Ç—å! –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞?`, 'in');
                setTimeout(() => els.input.focus(), 300);
            }
            
            scrollToBottom();
            vibrate();
        }

        els.input.addEventListener('input', function() { this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px'; });
        els.input.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleUserSend(); } });
        els.usernameInput.addEventListener('keydown', function(e) { if (e.key === 'Enter') { saveNameAndStart(); } });

    </script>
</body>
</html>

